"use strict";(self.webpackChunkhousing_dashboard=self.webpackChunkhousing_dashboard||[]).push([[2843],{8203:(e,t,i)=>{i.d(t,{A:()=>f});var r,n=i(89379),l=i(35143),o=i(45802),a=i(42553),s=i(53084),u=i(46053),d=(i(81806),i(76460),i(85842)),c=i(31608),p=i(97015),h=i(59187);const v=new o.J({esriSpatialRelIntersects:"intersects",esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelDisjoint:"disjoint",esriSpatialRelEnvelopeIntersects:"envelope-intersects",esriSpatialRelIndexIntersects:"index-intersects",esriSpatialRelOverlaps:"overlaps",esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",esriSpatialRelRelation:"relation"}),y=new o.J({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"});let g=r=class extends a.A{constructor(e){super(e),this.where=null,this.geometry=null,this.spatialRelationship="intersects",this.distance=void 0,this.objectIds=null,this.units=null,this.timeExtent=null}createQuery(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{where:t,geometry:i,spatialRelationship:r,timeExtent:l,objectIds:o,units:a,distance:u}=this;return new p.A((0,n.A)({geometry:(0,s.o8)(i),objectIds:(0,s.o8)(o),spatialRelationship:r,timeExtent:(0,s.o8)(l),where:t,units:a,distance:u},e))}clone(){const{where:e,geometry:t,spatialRelationship:i,timeExtent:n,objectIds:l,units:o,distance:a}=this;return new r({geometry:(0,s.o8)(t),objectIds:(0,s.o8)(l),spatialRelationship:i,timeExtent:(0,s.o8)(n),where:e,units:o,distance:a})}};(0,l._)([(0,u.MZ)({type:String,json:{write:!0}})],g.prototype,"where",void 0),(0,l._)([(0,u.MZ)({types:c.yR,json:{write:!0}})],g.prototype,"geometry",void 0),(0,l._)([(0,u.MZ)({type:v.apiValues,json:{name:"spatialRel",read:{reader:v.read},write:{allowNull:!1,writer:v.write,overridePolicy(){return{enabled:null!=this.geometry}}}}})],g.prototype,"spatialRelationship",void 0),(0,l._)([(0,u.MZ)({type:Number,json:{write:{overridePolicy(e){return{enabled:null!=e&&null!=this.geometry}}}}})],g.prototype,"distance",void 0),(0,l._)([(0,u.MZ)({type:[Number],json:{write:!0}})],g.prototype,"objectIds",void 0),(0,l._)([(0,u.MZ)({type:y.apiValues,json:{read:y.read,write:{writer:y.write,overridePolicy(e){return{enabled:null!=e&&null!=this.geometry}}}}})],g.prototype,"units",void 0),(0,l._)([(0,u.MZ)({type:h.A,json:{write:!0}})],g.prototype,"timeExtent",void 0),g=r=(0,l._)([(0,d.$)("esri.layers.support.FeatureFilter")],g);const f=g},12843:(e,t,i)=>{i.d(t,{FeatureSnappingEngine:()=>H});var r=i(35143),n=i(91967),l=i(18690),o=i(54901),a=i(81806),s=i(50346),u=i(68134),d=i(31633),c=i(46053),p=i(76460),h=i(85842),v=i(19555),y=i(20664),g=i(9392),f=i(53494),S=i(19451),w=i(12482),m=i(75543),_=i(23862),b=i(89379),R=i(34154),F=(i(47249),i(8203)),M=i(46530),x=i(31933),I=i(70330),A=i(90992);let E=class extends n.A{set attributeRulesEnabled(e){this._set("attributeRulesEnabled",e),e&&this.loadRules()}get layerView(){var e;return null===(e=this.view)||void 0===e||null===(e=e.allLayerViews)||void 0===e?void 0:e.find((e=>e.layer===this.layer))}get valid(){const{_valid:e,snappingSource:t,layer:i}=this;return!(!t||!i)&&e}get subtypeFilter(){var e,t,i;const{layer:r,snappingSource:n}=this;if(!(0,x.F2)(r)||null===(e=r.subtypes)||void 0===e||!e.length||!n)return{mode:"not-in-use",filter:null};const l=n.layerSource.sublayerSources.filter((e=>{var t;return e.enabled&&e.layer.visible&&(0,A.JU)(null===(t=this.view)||void 0===t?void 0:t.scale,e.layer.effectiveScaleRange.minScale,e.layer.effectiveScaleRange.maxScale)})).map((e=>e.layer.subtypeCode));if(!l.length)return{mode:"none-visible",filter:null};if(l.length===r.subtypes.length)return{mode:"all-visible",filter:null};const o=null!==(t=null===(i=r.fieldsIndex.get(r.subtypeField))||void 0===i?void 0:i.name)&&void 0!==t?t:r.subtypeField;return 1===l.length?{mode:"in-use",filter:"".concat(o," = ").concat(l.getItemAt(0))}:{mode:"in-use",filter:"".concat(o," IN (").concat(l.join(", "),")")}}get floorFilter(){const{view:e,layer:t}=this;return e&&t?(0,M.E)({view:e,layer:t}):null}constructor(e){super(e),this.layer=null,this.snappingSource=null,this.rulesTable=null,this._valid=null}initialize(){if(!this.snappingSource||!this.layer)return void(this._valid=!1);const{layer:e,snappingSource:t}=this;if("refresh"in e){const i=e;this.addHandles(i.on("refresh",(()=>t.refresh())))}this.loadRules(),this.addHandles([(0,u.wB)((()=>t.updating),(e=>t.layerSource.updating=e),u.pc),(0,u.wB)((()=>t.availability),(e=>t.layerSource.availability=e),u.pc)])}getFetchCandidatesParameters(e,t,i){var r,n,l,o,s;if(!this.valid)return[];const{layer:u,layerView:d,floorFilter:c,rulesTable:p,subtypeFilter:h}=this,v=(0,b.A)((0,b.A)({distance:i,mode:null!==(r=null===(n=this.view)||void 0===n?void 0:n.type)&&void 0!==r?r:"2d",point:e,coordinateHelper:t.coordinateHelper},{returnEdge:!0,vertexMode:"all"}),{},{filter:d&&"filter"in d?d.filter:null});if(c&&(v.filter=j(v.filter,c)),"not-in-use"!==h.mode&&"all-visible"!==h.mode){if("none-visible"===h.mode)return[];v.filter?v.filter.where=(0,R.mA)(v.filter.where,h.mode):v.filter=new F.A({where:h.filter})}if(!this.attributeRulesEnabled)return[v];const y=t.feature,g="subtype-sublayer"===(null===y||void 0===y||null===(l=y.sourceLayer)||void 0===l?void 0:l.type)?y.sourceLayer.parent:null===y||void 0===y?void 0:y.sourceLayer;if(p&&y&&(0,I.Tu)(null===(o=this.view)||void 0===o?void 0:o.map)&&((0,x.yZ)(u)||(0,x.F2)(u))&&((0,x.yZ)(g)||(0,x.F2)(g))&&null!==(s=this.view.map.utilityNetworks)&&void 0!==s&&s.find((e=>e.isUtilityLayer(g)))){var f,S;if("loaded"!==p.loadStatus)return[];const e=[],t=u.layerId,i=null===(f=p.getFeatureSQL(g,y))||void 0===f?void 0:f[t];if(!i)return[];const r=i.anyVertex;let n=i.endVertex;return n&&r&&n===r&&(n=""),n&&e.push((0,b.A)((0,b.A)({},v),{},{returnEdge:!1,vertexMode:"ends",filter:j(v.filter,n)})),r&&e.push((0,b.A)((0,b.A)({},v),{},{returnEdge:null!==(S=(0,a.A)("snapping-include-edges-when-applying-any-vertex-rule"))&&void 0!==S&&S,vertexMode:"all",filter:j(v.filter,r)})),e}return[v]}async loadRules(){this._valid=null;const{layer:e,view:t,attributeRulesEnabled:i}=this;if(i&&e&&t&&(0,I.Tu)(null===t||void 0===t?void 0:t.map)&&((0,x.yZ)(e)||(0,x.F2)(e)))try{var r,n,l,o;await Promise.allSettled(null!==(r=null===(n=t.map.utilityNetworks)||void 0===n?void 0:n.map((e=>e.load())))&&void 0!==r?r:[]);const i=null===(l=t.map.utilityNetworks)||void 0===l?void 0:l.find((t=>t.isUtilityLayer(e)));i&&(this.rulesTable=await i.getRulesTable(),await(null===(o=this.rulesTable)||void 0===o?void 0:o.load()))}catch(a){return this._valid=!1,void p.A.getLogger("esri.views.interactive.snapping.FeatureSnappingSourceInfo").error("Failed to load rules table for snapping source",e.title)}this._valid=!0}remove(){this.destroy()}destroy(){var e;null===(e=this.snappingSource)||void 0===e||e.destroy()}};function j(e,t){return null==e?new F.A({where:t}):e.where?new F.A({where:(0,R.mA)(e.where,t)}):new F.A({where:t})}(0,r._)([(0,c.MZ)({constructOnly:!0})],E.prototype,"layer",void 0),(0,r._)([(0,c.MZ)({constructOnly:!0})],E.prototype,"snappingSource",void 0),(0,r._)([(0,c.MZ)({constructOnly:!0})],E.prototype,"view",void 0),(0,r._)([(0,c.MZ)({value:!1})],E.prototype,"attributeRulesEnabled",null),(0,r._)([(0,c.MZ)()],E.prototype,"layerView",null),(0,r._)([(0,c.MZ)()],E.prototype,"rulesTable",void 0),(0,r._)([(0,c.MZ)()],E.prototype,"valid",null),(0,r._)([(0,c.MZ)()],E.prototype,"subtypeFilter",null),(0,r._)([(0,c.MZ)()],E.prototype,"floorFilter",null),(0,r._)([(0,c.MZ)()],E.prototype,"_valid",void 0),E=(0,r._)([(0,h.$)("esri.views.interactive.snapping.FeatureSnappingSourceInfo")],E);var Z=i(99791),L=i(80794),C=i(9876),T=i(61751),P=i(78228),z=i(17072);let H=class extends n.A{get updating(){return this._snappingSources.some((e=>{var t;return null==(null===e||void 0===e?void 0:e.valid)||!0===e.valid&&!0===(null===(t=e.snappingSource)||void 0===t?void 0:t.updating)}))||this._updatingHandles.updating}constructor(e){super(e),this.options=null,this._domain=Z.n.FEATURE,this._updatingHandles=new S.U,this._sourceModules={featureService:{module:null,loader:null},featureCollection:{module:null,loader:null},graphics:{module:null,loader:null},notes:{module:null,loader:null},scene:{module:null,loader:null}}}initialize(){const e=(0,u.lZ)((()=>{var e;return null===(e=this.options)||void 0===e?void 0:e._effectiveFeatureSources}),((e,t)=>this._createSourceInfo(e,t)));this._snappingSources=e,this.addHandles([(0,o.DQ)(e),(0,u.wB)((()=>{var e;return{rulesEnabled:!(null===(e=this.options)||void 0===e||!e.attributeRulesEnabled),sources:this._snappingSources.filter(l.Ru)}}),(e=>{let{rulesEnabled:t,sources:i}=e;for(const r of i)r.attributeRulesEnabled=t}),u.OH)])}destroy(){this._set("options",null),this._updatingHandles.destroy()}async fetchCandidates(e,t,i,r){if(!(t&this._domain&&null!=this.options&&this.options.effectiveFeatureEnabled))return[];const n=[],l=this._computeScreenSizeDistanceParameters(e,i);for(const s of this._snappingSources){var o,a;if(null===s||void 0===s||!s.valid||null===(o=s.snappingSource)||void 0===o||null===(o=o.layerSource)||void 0===o||!o.enabled||null!==(a=s.layerView)&&void 0!==a&&a.suspended)continue;const t=s.getFetchCandidatesParameters(e,i,l);for(const e of t)n.push(s.snappingSource.fetchCandidates(e,r).then((e=>e.filter((e=>!this._candidateIsExcluded(s.snappingSource,e,i.excludeFeature))))))}const u=(await(0,s.nA)(n)).flat();return this._addRightAngleCandidates(u,e,l,i),(0,s.Te)(r),(0,I.xX)(e,u),u}_addRightAngleCandidates(e,t,i,r){var n,l,o,a;const s=null!=r.vertexHandle?null===(n=r.vertexHandle.rightEdge)||void 0===n||null===(n=n.rightVertex)||void 0===n?void 0:n.pos:null!=r.editGeometryOperations&&"polygon"===r.editGeometryOperations.data.type?null===(l=r.editGeometryOperations.data.components[0])||void 0===l||null===(l=l.getFirstVertex())||void 0===l?void 0:l.pos:null,u=null!=r.vertexHandle?null===(o=r.vertexHandle.leftEdge)||void 0===o||null===(o=o.leftVertex)||void 0===o?void 0:o.pos:null!=r.editGeometryOperations?null===(a=r.editGeometryOperations.data.components[0])||void 0===a||null===(a=a.getLastVertex())||void 0===a?void 0:a.pos:null,{view:d}=this,c=(0,_.Lp)(s,d,r),p=(0,_.Lp)(u,d,r),h=e.length;for(let v=0;v<h;v++)this._addRightAngleCandidate(e[v],p,t,i,e),this._addRightAngleCandidate(e[v],c,t,i,e)}_addRightAngleCandidate(e,t,i,r,n){if(null==t||!function(e){return(e instanceof C.z||e instanceof L.X)&&!function(e){let{constraint:{start:t,end:i}}=e;const r=(0,y.s)(t,i),n=(0,v.hG)((0,_.Xz)(t),(0,_.Xz)(i));return r<(0,f.FD)()||n/r<N}(e)}(e))return;const l=e.constraint.closestTo(t),o=(l[0]-i[0])/r.x,a=(l[1]-i[1])/r.y,{start:s,end:u}=e.constraint;if(o*o+a*a<=1){const i=(0,v.hG)((0,_.Xz)(l),(0,_.Xz)(s))>(0,v.hG)((0,_.Xz)(l),(0,_.Xz)(u))?s:u,r=new P.HJ({targetPoint:(0,_.de)(l),otherVertex:t,otherVertexType:P.pn.NEXT,previousVertex:i,constraint:new m.FX(t,l),objectId:e.objectId,isDraped:e.isDraped,domain:Z.n.FEATURE});n.push(r)}}_computeScreenSizeDistanceParameters(e,t){let i=null!=this.options?this.options.distance*("touch"===t.pointer?this.options.touchSensitivityMultiplier:1):0;return null==this.view?{x:i,y:i,z:i,distance:i}:"2d"===this.view.type?(i*=this.view.resolution,{x:i,y:i,z:i,distance:i}):this._computeScreenSizeDistanceParameters3D(e,i,this.view,t)}_computeScreenSizeDistanceParameters3D(e,t,i,r){const{spatialReference:n}=r;i.renderCoordsHelper.toRenderCoords(e,n,O);const l=i.state.camera.computeScreenPixelSizeAt(O),o=l*i.renderCoordsHelper.unitInMeters,a=o/(0,d.GA)(n),s=o/(0,d.G9)(n),u=t*a,c=t*s,p=(0,z.j)(e,n,w.qt,i),h=p?G(p,e,a,0,0,i,r):0,v=p?G(p,e,0,a,0,i,r):0,y=p?G(p,e,0,0,s,i,r):0;return{x:0===h?0:u/h,y:0===v?0:u/v,z:0===y?0:c/y,distance:l*t}}_candidateIsExcluded(e,t,i){if(null==i)return!1;const r=this._getCandidateObjectId(t);if(null==r)return!1;const n=e.layerSource.layer;return"graphics"===n.type?i.uid===r:i.sourceLayer===n&&!(!i.attributes||!("objectIdField"in n))&&i.attributes[n.objectIdField]===r}_getCandidateObjectId(e){return e instanceof T.w?e.objectId:null}async _createSourceInfo(e,t){const i=e.layer;i.loaded||(await i.load(),(0,s.Te)(t));const{view:r}=this,n=await this._createFeatureSnappingSourceType(e);return(0,s.Te)(t),new E(null==n?{}:{snappingSource:n,view:r,layer:i})}async _createFeatureSnappingSourceType(e){switch(e.layer.type){case"feature":case"geojson":case"csv":case"oriented-imagery":case"subtype-group":case"wfs":return this._createFeatureSnappingSourceFeatureLayer(e);case"graphics":return this._createFeatureSnappingSourceGraphicsLayer(e);case"map-notes":return this._createFeatureSnappingSourceMapNotesLayer(e);case"scene":case"building-scene":return this._createFeatureSnappingSourceSceneLayer(e)}return null}async _createFeatureSnappingSourceSceneLayer(e){const{view:t}=this;return null==t||"3d"!==t.type?null:new((await this._getSourceModule("scene")).SceneLayerSnappingSource)({layerSource:e,view:t})}async _createFeatureSnappingSourceFeatureLayer(e){var t;switch(null===(t=e.layer.source)||void 0===t?void 0:t.type){case"feature-layer":case"oriented-imagery":return new((await this._getSourceModule("featureService")).FeatureServiceSnappingSource)({spatialReference:this.spatialReference,view:this.view,layerSource:e});case"memory":case"csv":case"geojson":case"wfs":return"mesh"===e.layer.geometryType?null:new((await this._getSourceModule("featureCollection")).FeatureCollectionSnappingSource)({layerSource:e,view:this.view})}return null}async _createFeatureSnappingSourceGraphicsLayer(e){return new((await this._getSourceModule("graphics")).GraphicsSnappingSource)({getGraphicsLayers:()=>[e.layer],spatialReference:this.spatialReference,view:this.view,layerSource:e})}async _createFeatureSnappingSourceMapNotesLayer(e){return new((await this._getSourceModule("notes")).GraphicsSnappingSource)({getGraphicsLayers:()=>{var t,i;return null!==(t=null===(i=e.layer.sublayers)||void 0===i?void 0:i.toArray())&&void 0!==t?t:[]},spatialReference:this.spatialReference,view:this.view,layerSource:e})}async _getSourceModule(e){const t=this._sourceModules[e];if(null==t.loader){const t=this._loadSourceModule(e),i={module:null,loader:t};this._sourceModules[e]=i;const r=await t,n={module:r,loader:t};return this._sourceModules[e]=n,r}return null==t.module?t.loader:t.module}_loadSourceModule(e){const t=this._updatingHandles;switch(e){case"featureService":return t.addPromise(i.e(1927).then(i.bind(i,51927)));case"featureCollection":return t.addPromise(i.e(7567).then(i.bind(i,77567)));case"graphics":case"notes":return t.addPromise(Promise.all([i.e(8683),i.e(2003),i.e(8094),i.e(4439),i.e(6e3),i.e(9546)]).then(i.bind(i,99546)));case"scene":return t.addPromise(Promise.all([i.e(8105),i.e(2259),i.e(1929)]).then(i.bind(i,91929)))}}get test(){}};function G(e,t,i,r,n,l,o){let{spatialReference:a}=o;const s=(0,y.c)(V,t);s[0]+=i,s[1]+=r,s[2]+=n;const u=(0,z.j)(s,a,w.qt,l);return u?(0,I.Mo)(u,e):1/0}(0,r._)([(0,c.MZ)({constructOnly:!0})],H.prototype,"spatialReference",void 0),(0,r._)([(0,c.MZ)({constructOnly:!0})],H.prototype,"view",void 0),(0,r._)([(0,c.MZ)()],H.prototype,"options",void 0),(0,r._)([(0,c.MZ)({readOnly:!0})],H.prototype,"updating",null),(0,r._)([(0,c.MZ)()],H.prototype,"_snappingSources",void 0),H=(0,r._)([(0,h.$)("esri.views.interactive.snapping.FeatureSnappingEngine")],H);const O=(0,g.vt)(),V=(0,g.vt)(),N=1e-4},46530:(e,t,i)=>{function r(e){var t;const i=e.layer;return"floorInfo"in i&&null!==(t=i.floorInfo)&&void 0!==t&&t.floorField&&"floors"in e.view?l(e.view.floors,i.floorInfo.floorField):null}function n(e,t){var i;return"floorInfo"in t&&null!==(i=t.floorInfo)&&void 0!==i&&i.floorField?l(e,t.floorInfo.floorField):null}function l(e,t){if(null===e||void 0===e||!e.length)return null;const i=e.filter((e=>""!==e)).map((e=>"'".concat(e,"'")));return i.push("''"),"".concat(t," IN (").concat(i.join(","),") OR ").concat(t," IS NULL")}i.d(t,{E:()=>r,f:()=>n})}}]);
//# sourceMappingURL=2843.49f65745.chunk.js.map