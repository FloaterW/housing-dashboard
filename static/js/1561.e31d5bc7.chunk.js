"use strict";(self.webpackChunkhousing_dashboard=self.webpackChunkhousing_dashboard||[]).push([[1561],{317:(e,t,r)=>{r.d(t,{k9:()=>T,zF:()=>b});var i,n=r(35143),o=r(42553),a=r(46053),s=(r(81806),r(76460),r(47249),r(6409)),l=r(85842);let c=i=class extends o.A{constructor(e){super(e),this.type="cloudy",this.cloudCover=.5}clone(){return new i({cloudCover:this.cloudCover})}};(0,n._)([(0,s.e)({cloudy:"cloudy"}),(0,a.MZ)({json:{write:{isRequired:!0}}})],c.prototype,"type",void 0),(0,n._)([(0,a.MZ)({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],c.prototype,"cloudCover",void 0),c=i=(0,n._)([(0,l.$)("esri.views.3d.environment.CloudyWeather")],c);const h=c;var d;let u=d=class extends o.A{constructor(e){super(e),this.type="foggy",this.fogStrength=.5}clone(){return new d({fogStrength:this.fogStrength})}};(0,n._)([(0,s.e)({foggy:"foggy"}),(0,a.MZ)({json:{write:{isRequired:!0}}})],u.prototype,"type",void 0),(0,n._)([(0,a.MZ)({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],u.prototype,"fogStrength",void 0),u=d=(0,n._)([(0,l.$)("esri.views.3d.environment.FoggyWeather")],u);const g=u;var p;let v=p=class extends o.A{constructor(e){super(e),this.type="rainy",this.cloudCover=.5,this.precipitation=.5}clone(){return new p({cloudCover:this.cloudCover,precipitation:this.precipitation})}};(0,n._)([(0,s.e)({rainy:"rainy"}),(0,a.MZ)({json:{write:{isRequired:!0}}})],v.prototype,"type",void 0),(0,n._)([(0,a.MZ)({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],v.prototype,"cloudCover",void 0),(0,n._)([(0,a.MZ)({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],v.prototype,"precipitation",void 0),v=p=(0,n._)([(0,l.$)("esri.views.3d.environment.RainyWeather")],v);const f=v;var _;let m=_=class extends o.A{constructor(e){super(e),this.type="snowy",this.cloudCover=.5,this.precipitation=.5,this.snowCover="disabled"}clone(){return new _({cloudCover:this.cloudCover,precipitation:this.precipitation,snowCover:this.snowCover})}};(0,n._)([(0,s.e)({snowy:"snowy"}),(0,a.MZ)({json:{write:{isRequired:!0}}})],m.prototype,"type",void 0),(0,n._)([(0,a.MZ)({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],m.prototype,"cloudCover",void 0),(0,n._)([(0,a.MZ)({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],m.prototype,"precipitation",void 0),(0,n._)([(0,a.MZ)({type:["enabled","disabled"],nonNullable:!0,json:{write:!0}})],m.prototype,"snowCover",void 0),m=_=(0,n._)([(0,l.$)("esri.views.3d.environment.SnowyWeather")],m);const x=m;var y;let w=y=class extends o.A{constructor(e){super(e),this.type="sunny",this.cloudCover=.5}clone(){return new y({cloudCover:this.cloudCover})}};(0,n._)([(0,s.e)({sunny:"sunny"}),(0,a.MZ)({json:{write:{isRequired:!0}}})],w.prototype,"type",void 0),(0,n._)([(0,a.MZ)({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],w.prototype,"cloudCover",void 0),w=y=(0,n._)([(0,l.$)("esri.views.3d.environment.SunnyWeather")],w);const C={key:"type",base:w,typeMap:{sunny:w,cloudy:h,rainy:f,snowy:x,foggy:g}};Object.keys(C.typeMap);const b=1e4,T=1e5},442:(e,t,r)=>{r.d(t,{$:()=>c});var i=r(90632),n=r(34761),o=r(13191),a=r(20664),s=r(78315),l=r(94966);class c{constructor(e){var t;let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.geometry=e,this.screenToWorldRatio=1,this._transformation=(0,o.vt)(),this._shaderTransformation=null,this._boundingSphere=null,this.id=(0,i.c)(),this.layerUid=r.layerUid,this.graphicUid=r.graphicUid,this.castShadow=null!==(t=r.castShadow)&&void 0!==t&&t,r.objectShaderTransformation&&this.objectShaderTransformationChanged(r.objectShaderTransformation)}get transformation(){return this._transformation}set transformation(e){(0,n.C)(this._transformation,e),this._boundingSphere=null}get boundingInfo(){return this.geometry.boundingInfo}objectShaderTransformationChanged(e){var t;null==e?this._shaderTransformation=null:(null!==(t=this._shaderTransformation)&&void 0!==t||(this._shaderTransformation=(0,o.vt)()),(0,n.lw)(this._shaderTransformation,e,this.geometry.transformation)),this._boundingSphere=null}get boundingSphere(){var e;return this.boundingInfo?(null==this._boundingSphere&&(null!==(e=this._boundingSphere)&&void 0!==e||(this._boundingSphere=(0,s.c)()),(0,a.t)((0,s.a)(this._boundingSphere),this.boundingInfo.center,this.shaderTransformation),this._boundingSphere[3]=this.boundingInfo.radius*(0,l.hG)(this.shaderTransformation)),this._boundingSphere):s.N}get material(){return this.geometry.material}get type(){return this.geometry.type}get shaderTransformation(){var e;return null!==(e=this._shaderTransformation)&&void 0!==e?e:this.transformation}get attributes(){return this.geometry.attributes}get highlight(){return this.geometry.highlights}foreachHighlightOptions(e){this.geometry.foreachHighlightOptions(e)}get hasHighlights(){return this.geometry.hasHighlights}get occludees(){return this.geometry.occludees}get visible(){return this.geometry.visible}set visible(e){this.geometry.visible=e}}},9001:(e,t,r)=>{r.d(t,{E:()=>Z});var i,n=r(57528),o=r(32925),a=r(99746),s=r(86955);function l(e){e.fragment.code.add((0,s.H)(i||(i=(0,n.A)(["\n    const float GAMMA = ",";\n    const float INV_GAMMA = ",";\n\n    vec4 delinearizeGamma(vec4 color) {\n      return vec4(pow(color.rgb, vec3(INV_GAMMA)), color.a);\n    }\n\n    vec3 linearizeGamma(vec3 color) {\n      return pow(color, vec3(GAMMA));\n    }\n  "])),s.H.float(a.Tf),s.H.float(1/a.Tf)))}var c,h=r(42953),d=r(48353),u=r(65058),g=r(28450),p=r(23148),v=r(23687),f=r(4653);function _(e,t){if(!t.screenSpaceReflections)return;const r=e.fragment;r.include(u.E),r.uniforms.add(new g.E("nearFar",(e=>e.camera.nearFar)),new f.x("depthMap",(e=>{var t;return null===(t=e.depth)||void 0===t?void 0:t.attachment})),new v.F("proj",(e=>e.camera.projectionMatrix)),new p.U("invResolutionHeight",(e=>1/e.camera.height)),new v.F("reprojectionMatrix",(e=>e.ssr.reprojectionMatrix))).code.add((0,s.H)(c||(c=(0,n.A)(["\n  vec2 reprojectionCoordinate(vec3 projectionCoordinate)\n  {\n    vec4 zw = proj * vec4(0.0, 0.0, -projectionCoordinate.z, 1.0);\n    vec4 reprojectedCoord = reprojectionMatrix * vec4(zw.w * (projectionCoordinate.xy * 2.0 - 1.0), zw.z, zw.w);\n    reprojectedCoord.xy /= reprojectedCoord.w;\n    return reprojectedCoord.xy * 0.5 + 0.5;\n  }\n\n  const int maxSteps = ",";\n\n  vec4 applyProjectionMat(mat4 projectionMat, vec3 x)\n  {\n    vec4 projectedCoord =  projectionMat * vec4(x, 1.0);\n    projectedCoord.xy /= projectedCoord.w;\n    projectedCoord.xy = projectedCoord.xy*0.5 + 0.5;\n    return projectedCoord;\n  }\n\n  vec3 screenSpaceIntersection(vec3 dir, vec3 startPosition, vec3 viewDir, vec3 normal)\n  {\n    vec3 viewPos = startPosition;\n    vec3 viewPosEnd = startPosition;\n\n    // Project the start position to the screen\n    vec4 projectedCoordStart = applyProjectionMat(proj, viewPos);\n    vec3  Q0 = viewPos / projectedCoordStart.w; // homogeneous camera space\n    float k0 = 1.0/ projectedCoordStart.w;\n\n    // advance the position in the direction of the reflection\n    viewPos += dir;\n\n    vec4 projectedCoordVanishingPoint = applyProjectionMat(proj, dir);\n\n    // Project the advanced position to the screen\n    vec4 projectedCoordEnd = applyProjectionMat(proj, viewPos);\n    vec3  Q1 = viewPos / projectedCoordEnd.w; // homogeneous camera space\n    float k1 = 1.0/ projectedCoordEnd.w;\n\n    // calculate the reflection direction in the screen space\n    vec2 projectedCoordDir = (projectedCoordEnd.xy - projectedCoordStart.xy);\n    vec2 projectedCoordDistVanishingPoint = (projectedCoordVanishingPoint.xy - projectedCoordStart.xy);\n\n    float yMod = min(abs(projectedCoordDistVanishingPoint.y), 1.0);\n\n    float projectedCoordDirLength = length(projectedCoordDir);\n    float maxSt = float(maxSteps);\n\n    // normalize the projection direction depending on maximum steps\n    // this determines how blocky the reflection looks\n    vec2 dP = yMod * (projectedCoordDir)/(maxSt * projectedCoordDirLength);\n\n    // Normalize the homogeneous camera space coordinates\n    vec3  dQ = yMod * (Q1 - Q0)/(maxSt * projectedCoordDirLength);\n    float dk = yMod * (k1 - k0)/(maxSt * projectedCoordDirLength);\n\n    // initialize the variables for ray marching\n    vec2 P = projectedCoordStart.xy;\n    vec3 Q = Q0;\n    float k = k0;\n    float rayStartZ = -startPosition.z; // estimated ray start depth value\n    float rayEndZ = -startPosition.z;   // estimated ray end depth value\n    float prevEstimateZ = -startPosition.z;\n    float rayDiffZ = 0.0;\n    float dDepth;\n    float depth;\n    float rayDiffZOld = 0.0;\n\n    // early outs\n    if (dot(normal, dir) < 0.0 || dot(-viewDir, normal) < 0.0)\n      return vec3(P, 0.0);\n    float dDepthBefore = 0.0;\n\n    for(int i = 0; i < maxSteps-1; i++)\n    {\n      depth = -linearDepthFromTexture(depthMap, P); // get linear depth from the depth buffer\n\n      // estimate depth of the marching ray\n      rayStartZ = prevEstimateZ;\n      dDepth = -rayStartZ - depth;\n      rayEndZ = (dQ.z * 0.5 + Q.z)/ ((dk * 0.5 + k));\n      rayDiffZ = rayEndZ- rayStartZ;\n      prevEstimateZ = rayEndZ;\n\n      if(-rayEndZ > nearFar[1] || -rayEndZ < nearFar[0] || P.y < 0.0  || P.y > 1.0 )\n      {\n        return vec3(P, 0.);\n      }\n\n      // If we detect a hit - return the intersection point, two conditions:\n      //  - dDepth > 0.0 - sampled point depth is in front of estimated depth\n      //  - if difference between dDepth and rayDiffZOld is not too large\n      //  - if difference between dDepth and 0.025/abs(k) is not too large\n      //  - if the sampled depth is not behind far plane or in front of near plane\n\n      if((dDepth) < 0.025/abs(k) + abs(rayDiffZ) && dDepth > 0.0 && depth > nearFar[0] && depth < nearFar[1] && abs(P.y - projectedCoordStart.y) > invResolutionHeight)\n      {\n        float weight = dDepth / (dDepth - dDepthBefore);\n        vec2 Pf = mix(P - dP, P, 1.0 - weight);\n        if (abs(Pf.y - projectedCoordStart.y) > invResolutionHeight) {\n          return vec3(Pf, depth);\n        }\n        else {\n          return vec3(P, depth);\n        }\n      }\n\n      // continue with ray marching\n      P = clamp(P + dP, vec2(0.0), vec2(0.999));\n      Q.z += dQ.z;\n      k += dk;\n      rayDiffZOld = rayDiffZ;\n      dDepthBefore = dDepth;\n    }\n    return vec3(P, 0.0);\n  }\n  "])),t.highStepCount?"150":"75"))}var m,x,y,w,C,b,T=r(9392),S=r(14556),O=r(51977),R=r(63401),D=r(317),P=r(43557),I=r(67582),A=r(84115),M=r(69728),E=r(87003);class F extends E.n{constructor(e,t){super(e,"samplerCube",M.c.Bind,((r,i)=>r.bindTexture(e,t(i))))}}function N(e){const t=e.fragment;t.constants.add("radiusCloudsSquared","float",H).code.add((0,s.H)(m||(m=(0,n.A)(["vec3 intersectWithCloudLayer(vec3 dir, vec3 cameraPosition, vec3 spherePos) {\nfloat B = 2.0 * dot(cameraPosition, dir);\nfloat C = dot(cameraPosition, cameraPosition) - radiusCloudsSquared;\nfloat det = B * B - 4.0 * C;\nfloat pointIntDist = max(0.0, 0.5 *(-B + sqrt(det)));\nreturn (cameraPosition + dir * pointIntDist) - spherePos;\n}"])))),t.uniforms.add(new p.U("radiusCurvatureCorrection",(e=>{let{clouds:t}=e;return t.parallax.radiusCurvatureCorrection}))).code.add((0,s.H)(x||(x=(0,n.A)(["vec3 correctForPlanetCurvature(vec3 dir) {\ndir.z = dir.z * (1.0 - radiusCurvatureCorrection) + radiusCurvatureCorrection;\nreturn dir;\n}"])))),t.code.add((0,s.H)(y||(y=(0,n.A)(["vec3 rotateDirectionToAnchorPoint(mat4 rotMat, vec3 inVec) {\nreturn (rotMat * vec4(inVec, 0.0)).xyz;\n}"])))),(0,P.Gc)(t),(0,P.O4)(t);const r=(0,T.fA)(.28,.175,.035);t.constants.add("RIM_COLOR","vec3",r);t.code.add((0,s.H)(w||(w=(0,n.A)(["\n    vec3 calculateCloudColor(vec3 cameraPosition, vec3 worldSpaceRay, vec4 clouds) {\n      float upDotLight = dot(cameraPosition, mainLightDirection);\n      float dirDotLight = max(dot(worldSpaceRay, mainLightDirection), 0.0);\n      float sunsetTransition = clamp(pow(max(upDotLight, 0.0), ","), 0.0, 1.0);\n\n      // Base color of the clouds that depends on lighting of the sun and sky\n      vec3 ambientLight = calculateAmbientIrradiance(cameraPosition,  0.0);\n      vec3 combinedLight = clamp((mainLightIntensity + ambientLight )/PI, vec3(0.0), vec3(1.0));\n      vec3 baseCloudColor = pow(combinedLight * pow(clouds.xyz, vec3(GAMMA)), vec3(INV_GAMMA));\n\n      // Rim light around the edge of the clouds simulating scattering of the direct lun light\n      float scatteringMod = max(clouds.a < 0.5 ? clouds.a / 0.5 : - clouds.a / 0.5 + 2.0, 0.0);\n      float rimLightIntensity = 0.5 + 0.5 * pow(max(upDotLight, 0.0), 0.35);\n      vec3 directSunScattering = RIM_COLOR * rimLightIntensity * (pow(dirDotLight, ",")) * scatteringMod;\n\n      // Brighten the clouds around the sun at the sunsets\n      float additionalLight = "," * pow(dirDotLight, ",") * (1. - pow(sunsetTransition, ",")) ;\n\n      return vec3(baseCloudColor * (1.0 + additionalLight) + directSunScattering);\n    }\n  "])),s.H.float(.3),s.H.float(140),s.H.float(.2),s.H.float(10),s.H.float(.3))),t.uniforms.add(new I.o("readChannelsRG",(e=>e.clouds.readChannels===O.c.RG)),new F("cubeMap",(e=>{var t,r;return null!==(t=null===(r=e.clouds.data)||void 0===r||null===(r=r.cubeMap)||void 0===r?void 0:r.colorTexture)&&void 0!==t?t:null}))).code.add((0,s.H)(C||(C=(0,n.A)(["vec4 sampleCloud(vec3 rayDir, bool readOtherChannel) {\nvec4 s = texture(cubeMap, rayDir);\nbool readRG = readChannelsRG ^^ readOtherChannel;\ns = readRG ? vec4(vec3(s.r), s.g) : vec4(vec3(s.b), s.a);\nreturn length(s) == 0.0 ? vec4(s.rgb, 1.0) : s;\n}"])))),t.uniforms.add(new A.d("anchorPoint",(e=>e.clouds.parallax.anchorPoint)),new A.d("anchorPointNew",(e=>e.clouds.parallaxNew.anchorPoint)),new v.F("rotationClouds",(e=>e.clouds.parallax.transform)),new v.F("rotationCloudsNew",(e=>e.clouds.parallaxNew.transform)),new p.U("cloudsOpacity",(e=>e.clouds.opacity)),new p.U("fadeFactor",(e=>e.clouds.fadeFactor)),new I.o("crossFade",(e=>e.clouds.fadeState===R.c.CROSS_FADE))).code.add((0,s.H)(b||(b=(0,n.A)(["vec4 renderClouds(vec3 worldRay, vec3 cameraPosition) {\nvec3 intersectionPoint = intersectWithCloudLayer(worldRay, cameraPosition, anchorPoint);\nvec3 worldRayRotated = rotateDirectionToAnchorPoint(rotationClouds, normalize(intersectionPoint));\nvec3 worldRayRotatedCorrected = correctForPlanetCurvature(worldRayRotated);\nvec4 cloudData = sampleCloud(worldRayRotatedCorrected, crossFade);\nvec3 cameraPositionN = normalize(cameraPosition);\nvec4 cloudColor = vec4(calculateCloudColor(cameraPositionN, worldRay, cloudData), cloudData.a);\nif(crossFade) {\nintersectionPoint = intersectWithCloudLayer(worldRay, cameraPosition, anchorPointNew);\nworldRayRotated = rotateDirectionToAnchorPoint(rotationCloudsNew, normalize(intersectionPoint));\nworldRayRotatedCorrected = correctForPlanetCurvature(worldRayRotated);\ncloudData = sampleCloud(worldRayRotatedCorrected, false);\nvec4 cloudColorNew = vec4(calculateCloudColor(cameraPositionN, worldRay, cloudData), cloudData.a);\ncloudColor = mix(cloudColor, cloudColorNew, fadeFactor);\n}\nfloat totalTransmittance = length(cloudColor.rgb) == 0.0 ?\n1.0 :\nclamp(cloudColor.a * cloudsOpacity + (1.0 - cloudsOpacity), 0.0 , 1.0);\nreturn vec4(cloudColor.rgb, totalTransmittance);\n}"]))))}const H=(S.$O.radius+D.k9)**2;var L,z,V,W,j,U,G,q,B;function k(e){e.code.add((0,s.H)(L||(L=(0,n.A)(["vec3 tonemapACES(vec3 x) {\nreturn clamp((x * (2.51 * x + 0.03)) / (x * (2.43 * x + 0.59) + 0.14), 0.0, 1.0);\n}"]))))}function Z(e,t){e.include(h.f,t),e.include(l),e.include(o.v),t.cloudReflections&&e.include(N),e.include(_,t);const r=e.fragment;r.include(k),r.constants.add("fresnelSky","vec3",[.02,1,15]),r.constants.add("fresnelMaterial","vec2",[.02,.1]),r.constants.add("roughness","float",.015),r.constants.add("foamIntensityExternal","float",1.7),r.constants.add("ssrIntensity","float",.65),r.constants.add("ssrHeightFadeStart","float",d.O),r.constants.add("ssrHeightFadeEnd","float",d.b),r.constants.add("waterDiffusion","float",.92),r.constants.add("waterSeaColorMod","float",.8),r.constants.add("correctionViewingPowerFactor","float",.4),r.constants.add("skyZenitColor","vec3",[.52,.68,.9]),r.constants.add("skyColor","vec3",[.67,.79,.9]),r.constants.add("cloudFresnelModifier","vec2",[1.2,.01]),r.code.add((0,s.H)(z||(z=(0,n.A)(["PBRShadingWater shadingInfo;\nvec3 getSkyGradientColor(in float cosTheta, in vec3 horizon, in vec3 zenit) {\nfloat exponent = pow((1.0 - cosTheta), fresnelSky[2]);\nreturn mix(zenit, horizon, exponent);\n}"])))),r.uniforms.add(new p.U("lightingSpecularStrength",(e=>e.lighting.mainLight.specularStrength)),new p.U("lightingEnvironmentStrength",(e=>e.lighting.mainLight.environmentStrength))),r.code.add((0,s.H)(V||(V=(0,n.A)(["vec3 getSeaColor(in vec3 n, in vec3 v, in vec3 l, vec3 color, in vec3 lightIntensity, in vec3 localUp, in float shadow, float foamIntensity, vec3 viewPosition, vec3 position) {\nfloat reflectionHit = 0.0;\nfloat reflectionHitDiffused = 0.0;\nvec3 seaWaterColor = linearizeGamma(color);\nvec3 h = normalize(l + v);\nshadingInfo.NdotV = clamp(dot(n, v), 0.001, 1.0);\nshadingInfo.VdotN = clamp(dot(v, n), 0.001, 1.0);\nshadingInfo.NdotH = clamp(dot(n, h), 0.0, 1.0);\nshadingInfo.VdotH = clamp(dot(v, h), 0.0, 1.0);\nshadingInfo.LdotH = clamp(dot(l, h), 0.0, 1.0);\nfloat upDotV = max(dot(localUp,v), 0.0);\nvec3 skyHorizon = linearizeGamma(skyColor);\nvec3 skyZenit = linearizeGamma(skyZenitColor);\nvec3 skyColor = getSkyGradientColor(upDotV, skyHorizon, skyZenit );\nfloat upDotL = max(dot(localUp,l),0.0);\nfloat daytimeMod = 0.1 + upDotL * 0.9;\nskyColor *= daytimeMod;\nfloat shadowModifier = clamp(shadow, 0.8, 1.0);\nvec3 fresnelModifier = fresnelReflection(shadingInfo.VdotN, vec3(fresnelSky[0]), fresnelSky[1]);\nvec3 reflSky = lightingEnvironmentStrength * fresnelModifier * skyColor * shadowModifier;\nvec3 reflSea = seaWaterColor * mix(skyColor, upDotL * lightIntensity * LIGHT_NORMALIZATION, 2.0 / 3.0) * shadowModifier;\nvec3 specular = vec3(0.0);\nif(upDotV > 0.0 && upDotL > 0.0) {\nvec3 specularSun = brdfSpecularWater(shadingInfo, roughness, vec3(fresnelMaterial[0]), fresnelMaterial[1]);\nvec3 incidentLight = lightIntensity * LIGHT_NORMALIZATION * shadow;\nfloat NdotL = clamp(dot(n, l), 0.0, 1.0);\nspecular = lightingSpecularStrength * NdotL * incidentLight * specularSun;\n}\nvec3 foam = vec3(0.0);\nif(upDotV > 0.0) {\nfoam = foamIntensity2FoamColor(foamIntensityExternal, foamIntensity, skyZenitColor, daytimeMod);\n}\nfloat correctionViewingFactor = pow(max(dot(v, localUp), 0.0), correctionViewingPowerFactor);\nvec3 normalCorrectedClouds = mix(localUp, n, correctionViewingFactor);\nvec3 reflectedWorld = normalize(reflect(-v, normalCorrectedClouds));"])))),t.cloudReflections&&r.uniforms.add(new p.U("cloudsOpacity",(e=>e.clouds.opacity))).code.add((0,s.H)(W||(W=(0,n.A)(["vec4 cloudsColor = renderClouds(reflectedWorld, position);\ncloudsColor.a = 1.0 - cloudsColor.a;\ncloudsColor = pow(cloudsColor, vec4(GAMMA));\ncloudsColor *= clamp(fresnelModifier.y * cloudFresnelModifier[0] - cloudFresnelModifier[1], 0.0, 1.0) * cloudsOpacity;"])))),t.screenSpaceReflections?r.uniforms.add(new v.F("view",(e=>e.camera.viewMatrix)),new f.x("lastFrameColorTexture",(e=>{var t;return null===(t=e.ssr.lastFrameColor)||void 0===t?void 0:t.getTexture()})),new p.U("fadeFactorSSR",(e=>e.ssr.fadeFactor))).code.add((0,s.H)(j||(j=(0,n.A)(["vec3 viewDir = normalize(viewPosition);\nvec4 viewNormalVectorCoordinate = view * vec4(n, 0.0);\nvec3 viewNormal = normalize(viewNormalVectorCoordinate.xyz);\nvec4 viewUp = view * vec4(localUp, 0.0);\nvec3 viewNormalCorrectedSSR = mix(viewUp.xyz, viewNormal, correctionViewingFactor);\nvec3 reflected = normalize(reflect(viewDir, viewNormalCorrectedSSR));\nvec3 hitCoordinate = screenSpaceIntersection(reflected, viewPosition, viewDir, viewUp.xyz);\nvec3 reflectedColor = vec3(0.0);\nif (hitCoordinate.z > 0.0)\n{\nvec2 reprojectedCoordinate = reprojectionCoordinate(hitCoordinate);\nvec2 dCoords = smoothstep(0.3, 0.6, abs(vec2(0.5, 0.5) - hitCoordinate.xy));\nfloat heightMod = smoothstep(ssrHeightFadeEnd, ssrHeightFadeStart, -viewPosition.z);\nreflectionHit = clamp(1.0 - (1.3 * dCoords.y), 0.0, 1.0) * heightMod * fadeFactorSSR;\nreflectionHitDiffused = waterDiffusion * reflectionHit;\nreflectedColor = linearizeGamma(texture(lastFrameColorTexture, reprojectedCoordinate).xyz) *\nreflectionHitDiffused * fresnelModifier.y * ssrIntensity;\n}\nfloat seaColorMod =  mix(waterSeaColorMod, waterSeaColorMod * 0.5, reflectionHitDiffused);\nvec3 waterRenderedColor = tonemapACES((1.0 - reflectionHitDiffused) * reflSky + reflectedColor +\nreflSea * seaColorMod + specular + foam);"])))):r.code.add((0,s.H)(U||(U=(0,n.A)(["vec3 waterRenderedColor = tonemapACES(reflSky + reflSea * waterSeaColorMod + specular + foam);"])))),t.cloudReflections?t.screenSpaceReflections?r.code.add((0,s.H)(G||(G=(0,n.A)(["return waterRenderedColor * (1.0 - (1.0 - reflectionHit) * cloudsColor.a) + (1.0 - reflectionHit) * cloudsColor.xyz;\n}"])))):r.code.add((0,s.H)(q||(q=(0,n.A)(["return waterRenderedColor * (1.0 - cloudsColor.a) + cloudsColor.xyz;\n}"])))):r.code.add((0,s.H)(B||(B=(0,n.A)(["return waterRenderedColor;\n}"]))))}},11850:(e,t,r)=>{r.d(t,{SL:()=>s,wR:()=>a});var i=r(66470),n=r(93345),o=r(21812);const a=[],s=[new o._(i.r.POSITION,3,n.pe.FLOAT,0,12)];new o._(i.r.POSITION,2,n.pe.FLOAT,0,8),new o._(i.r.POSITION,2,n.pe.FLOAT,0,16),new o._(i.r.UV0,2,n.pe.FLOAT,8,16)},19539:(e,t,r)=>{var i,n,o;r.d(t,{vr:()=>i}),function(e){e[e.INNER=0]="INNER",e[e.OUTER=1]="OUTER"}(i||(i={})),function(e){e[e.REGULAR=0]="REGULAR",e[e.HAS_NORTH_POLE=1]="HAS_NORTH_POLE",e[e.HAS_SOUTH_POLE=2]="HAS_SOUTH_POLE",e[e.HAS_BOTH_POLES=3]="HAS_BOTH_POLES"}(n||(n={})),function(e){e[e.FADING=0]="FADING",e[e.IMMEDIATE=1]="IMMEDIATE",e[e.UNFADED=2]="UNFADED"}(o||(o={}))},21019:(e,t,r)=>{r.d(t,{H:()=>h,a:()=>v,b:()=>p,c:()=>d,g:()=>u,o:()=>g});var i,n=r(57528),o=r(73398),a=r(86955),s=r(27374),l=r(31432),c=r(2687);class h extends l.Y{}function d(){const e=new c.N5,{outputs:t,fragment:r}=e;return e.include(o.c),r.uniforms.add(new s.o("textureInput",(e=>e.input))),r.constants.add("outlineWidth","int",Math.ceil(g)),r.constants.add("cellSize","int",u),t.add("fragGrid","vec2"),r.main.add((0,a.H)(i||(i=(0,n.A)(["ivec2 inputTextureSize = textureSize(textureInput, 0);\nivec2 cellBottomLeftCornerInput = ivec2(floor(gl_FragCoord.xy) * vec2(cellSize));\nivec2 coordMid =  cellBottomLeftCornerInput + ivec2(cellSize >> 1);\nuvec2 centreTexel = uvec2( texelFetch(textureInput, coordMid, 0).rg * 255.0) & uvec2(0x55u);\nfloat marginSquare = float(outlineWidth*outlineWidth);\nuvec2 outputValue = centreTexel & uvec2(0x55u);\nfor(int y = -outlineWidth; y <= cellSize + outlineWidth; y+=2) {\nint dy = y < 0 ? -y : y > cellSize ? y-cellSize : 0;\nint xMargin = dy > 0 ? int(ceil(sqrt(marginSquare - float(dy*dy)))) : outlineWidth;\nfor(int x = -xMargin; x <= cellSize + xMargin; x+=2) {\nivec2 coord = cellBottomLeftCornerInput + ivec2(x, y);\nuvec2[4] texels = uvec2[4] (\nuvec2(texelFetch(textureInput,coord+ivec2(0,0),0).rg * 255.0) & uvec2(0x55u),\nuvec2(texelFetch(textureInput,coord+ivec2(1,0),0).rg * 255.0) & uvec2(0x55u),\nuvec2(texelFetch(textureInput,coord+ivec2(0,1),0).rg * 255.0) & uvec2(0x55u),\nuvec2(texelFetch(textureInput,coord+ivec2(1,1),0).rg * 255.0) & uvec2(0x55u)\n);\nif (texels[0] == texels[1] && texels[1] == texels[2] && texels[2] == texels[3] && texels[3] ==  centreTexel) {\ncontinue;\n}\nfor (int i=0; i<4; ++i){\noutputValue |= ((texels[i] ^ centreTexel) << 1);\noutputValue |= texels[i];\n}\n}\n}\nfragGrid = vec2(outputValue) / 255.0;"])))),e}const u=32,g=9,p=.4,v=Object.freeze(Object.defineProperty({__proto__:null,HighlightDownsampleDrawParameters:h,blurSize:p,build:d,gridCellPixelSize:u,outlineSize:g},Symbol.toStringTag,{value:"Module"}))},29889:(e,t,r)=>{r.d(t,{A:()=>c,C:()=>l});var i=r(45308),n=r(44815),o=r(99785),a=r(67425),s=r(70558);function l(e,t,r,i){const s="polygon"===e.type?o.Wq.CCW_IS_HOLE:o.Wq.NONE,l="polygon"===e.type?e.rings:e.paths,{position:c,outlines:d}=(0,o.oR)(l,!!e.hasZ,s,e.spatialReference),u=(0,n.jh)(c.length),g=(0,a.au)(c,e.spatialReference,0,u,0,c,0,c.length/3,t,r,i),p=null!=g;return{lines:p?h(d,c,u):[],projectionSuccess:p,sampledElevation:g}}function c(e,t){const r="polygon"===e.type?o.Wq.CCW_IS_HOLE:o.Wq.NONE,n="polygon"===e.type?e.rings:e.paths,{position:a,outlines:l}=(0,o.oR)(n,!1,r),c=(0,i.projectBuffer)(a,e.spatialReference,0,a,t,0);for(let i=2;i<a.length;i+=3)a[i]=s.bi;return{lines:c?h(l,a):[],projectionSuccess:c}}function h(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const i=new Array;for(const{index:o,count:a}of e){if(a<=1)continue;const e=3*o,s=3*a;i.push({position:(0,n.l5)(t,3*o,3*a),mapPositions:null!=r?(0,n.l5)(r,e,s):void 0})}return i}},32925:(e,t,r)=>{r.d(t,{v:()=>l,z:()=>s});var i,n,o=r(57528),a=r(86955);function s(e){e.fragment.code.add((0,a.H)(i||(i=(0,o.A)(["float normals2FoamIntensity(vec3 n, float waveStrength){\nfloat normalizationFactor =  max(0.015, waveStrength);\nreturn max((n.x + n.y)*0.3303545/normalizationFactor + 0.3303545, 0.0);\n}"]))))}function l(e){e.fragment.code.add((0,a.H)(n||(n=(0,o.A)(["vec3 foamIntensity2FoamColor(float foamIntensityExternal, float foamPixelIntensity, vec3 skyZenitColor, float dayMod){\nreturn foamIntensityExternal * (0.075 * skyZenitColor * pow(foamPixelIntensity, 4.) +  50.* pow(foamPixelIntensity, 23.0)) * dayMod;\n}"]))))}},35925:(e,t,r)=>{r.d(t,{Xq:()=>s,wk:()=>a});const i={dash:[4,3],dot:[1,3],"long-dash":[8,3],"short-dash":[4,1],"short-dot":[1,1]},n={dash:i.dash,"dash-dot":[...i.dash,...i.dot],dot:i.dot,"long-dash":i["long-dash"],"long-dash-dot":[...i["long-dash"],...i.dot],"long-dash-dot-dot":[...i["long-dash"],...i.dot,...i.dot],none:null,"short-dash":i["short-dash"],"short-dash-dot":[...i["short-dash"],...i["short-dot"]],"short-dash-dot-dot":[...i["short-dash"],...i["short-dot"],...i["short-dot"]],"short-dot":i["short-dot"],solid:null},o=8;function a(e){return{pattern:[e,e],pixelRatio:2}}function s(e){return"style"===(null===e||void 0===e?void 0:e.type)?function(e){return null!=e?function(e,t){return null==e?e:{pattern:e.slice(),pixelRatio:t}}(n[e],o):null}(e.style):null}},37923:(e,t,r)=>{r.d(t,{C:()=>y,b:()=>x});var i,n,o=r(57528),a=r(26917),s=r(81776),l=r(90080),c=r(54478),h=r(94192),d=r(66763),u=r(80883),g=r(3799),p=r(58350),v=r(86955),f=r(66470),_=r(91911),m=r(2687);function x(e){const t=new m.N5,{vertex:r,fragment:x,attributes:y,varyings:w}=t,{vvColor:C,hasVertexColors:b}=e;return(0,g.NB)(r,e),t.include(s.d,e),t.include(c.c,e),t.include(d.A,e),t.include(l.g,e),x.include(a.HQ,e),t.include(_.z,e),t.include(h.Z,e),y.add(f.r.POSITION,"vec3"),C&&y.add(f.r.COLORFEATUREATTRIBUTE,"float"),b||w.add("vColor","vec4"),w.add("vpos","vec3"),r.uniforms.add(new p.E("uColor",(e=>e.color))),r.main.add((0,v.H)(i||(i=(0,o.A)(["\n      vpos = position;\n      forwardNormalizedVertexColor();\n      forwardObjectAndLayerIdColor();\n\n      ","\n      forwardViewPosDepth((view * vec4(vpos, 1.0)).xyz);\n      gl_Position = transformPosition(proj, view, vpos);"])),b?"vColor *= uColor;":C?"vColor = uColor * interpolateVVColor(colorFeatureAttribute);":"vColor = uColor;")),x.include(u.a),x.main.add((0,v.H)(n||(n=(0,o.A)(["discardBySlice(vpos);\ndiscardByTerrainDepth();\noutputColorHighlightOID(vColor, vpos);"])))),t}const y=Object.freeze(Object.defineProperty({__proto__:null,build:x},Symbol.toStringTag,{value:"Module"}))},47233:(e,t,r)=>{r.d(t,{Q:()=>v});var i=r(57528),n=r(19555),o=r(72745),a=r(86955),s=r(69728),l=r(87003);class c extends l.n{constructor(e,t){super(e,"ivec2",s.c.Pass,((r,i,n)=>r.setUniform2iv(e,t(i,n))))}}var h,d,u=r(72790),g=r(70367),p=r(21019);function v(e){const{vertex:t}=e;t.uniforms.add(new g.N("coverageTexture",(e=>e.coverageTexture)),new c("highlightRenderCellCount",(e=>(0,n.hZ)(f,e.horizontalCellCount,e.verticalCellCount))),new c("highlightTextureResolution",(e=>{let{highlightTexture:t}=e;return(0,n.hZ)(f,t.descriptor.width,t.descriptor.height)})),new u.c("highlightLevel",(e=>e.highlightLevel))).constants.add("cellSize","int",p.g),e.varyings.add("sUV","vec2"),e.varyings.add("vOutlinePossible","float"),t.code.add((0,a.H)(h||(h=(0,i.A)(["const ivec2 cellVertices[4] = ivec2[4](ivec2(0,0), ivec2(1,0), ivec2(0,1), ivec2(1,1));"])))).main.add((0,a.H)(d||(d=(0,i.A)(["int cellIndex = gl_InstanceID;\nint cellX = cellIndex % highlightRenderCellCount[0];\nint cellY = (cellIndex - cellX) / highlightRenderCellCount[0];\nivec2 cellPos = ivec2(cellX, cellY);\nuvec2 covTexel = uvec2(texelFetch(coverageTexture, cellPos, 0).rg * 255.0);\nint channelIndex = (highlightLevel >> 2) & 3;\nuint channelValue = covTexel[channelIndex];\nint highlightIndex = (highlightLevel & 3) << 1;\nbool covered = ((channelValue >> highlightIndex) & 1u) == 1u;\nif (!covered) {\ngl_Position = vec4(0.0);\nreturn;\n}\nvOutlinePossible = (((channelValue >> highlightIndex) & 2u) == 2u) ? 1.0 : 0.0;\nivec2 iPosInCell = cellVertices[gl_VertexID];\nvec2 sPos = vec2(cellPos * cellSize + iPosInCell * (cellSize));\nvec2 vPos = sPos / vec2(highlightTextureResolution);\nsUV = vPos;\ngl_Position = vec4(2.0 * vPos - vec2(1.0), 0.0, 1.0);"]))))}const f=(0,o.vt)()},51542:(e,t,r)=>{r.d(t,{S:()=>u,a:()=>p,b:()=>g});var i,n=r(57528),o=r(72745),a=r(47233),s=r(56289),l=r(86955),c=r(27374),h=r(31432),d=r(2687);class u extends h.Y{constructor(){super(...arguments),this.blurSize=(0,o.vt)()}}function g(){const e=new d.N5;return e.include(a.Q),e.outputs.add("fragSingleHighlight","vec2",0),e.fragment.uniforms.add(new s.t("blurSize",(e=>e.blurSize)),new c.o("blurInput",(e=>e.blurInput))).main.add((0,l.H)(i||(i=(0,n.A)(["vec2 highlightTextureSize = vec2(textureSize(blurInput,0));\nvec2 center = texture(blurInput, sUV).rg;\nif (vOutlinePossible == 0.0) {\nfragSingleHighlight = center;\n} else {\nvec2 sum = center * 0.204164;\nsum += texture(blurInput, sUV + blurSize * 1.407333).rg * 0.304005;\nsum += texture(blurInput, sUV - blurSize * 1.407333).rg * 0.304005;\nsum += texture(blurInput, sUV + blurSize * 3.294215).rg * 0.093913;\nsum += texture(blurInput, sUV - blurSize * 3.294215).rg * 0.093913;\nfragSingleHighlight = sum;\n}"])))),e}const p=Object.freeze(Object.defineProperty({__proto__:null,SingleHighlightBlurDrawParameters:u,build:g},Symbol.toStringTag,{value:"Module"}))},51977:(e,t,r)=>{var i,n;function o(e){return null!=e&&!e.running}r.d(t,{c:()=>n,pi:()=>o,tf:()=>i}),function(e){e[e.Idle=0]="Idle",e[e.Rendering=1]="Rendering",e[e.Ready=2]="Ready",e[e.Fading=3]="Fading"}(i||(i={})),function(e){e[e.RG=0]="RG",e[e.BA=1]="BA",e[e.COUNT=2]="COUNT"}(n||(n={}))},53070:(e,t,r)=>{r.d(t,{T:()=>u,a:()=>p,b:()=>g});var i,n=r(57528),o=r(9392),a=r(73398),s=r(5517),l=r(86955),c=r(70367),h=r(31432),d=r(2687);class u extends h.Y{constructor(){super(...arguments),this.color=(0,o.fA)(1,1,1)}}function g(){const e=new d.N5;return e.include(a.c),e.fragment.uniforms.add(new c.N("tex",(e=>e.texture)),new s.t("uColor",(e=>e.color))),e.fragment.main.add((0,l.H)(i||(i=(0,n.A)(["vec4 texColor = texture(tex, uv);\nfragColor = texColor * vec4(uColor, 1.0);"])))),e}const p=Object.freeze(Object.defineProperty({__proto__:null,TextureOnlyPassParameters:u,build:g},Symbol.toStringTag,{value:"Module"}))},53521:(e,t,r)=>{r.d(t,{q:()=>n});var i=r(79369);class n{constructor(e,t){this._storage=new i.F,this.id="",this.name="",this.size=0,this._storage.maxSize=e,this._storage.register(this),t&&this._storage.registerRemoveFunc("",t)}destroy(){this._storage.deregister(this),this._storage.destroy()}put(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;this._storage.put(this,e,t,r,1)}pop(e){return this._storage.pop(this,e)}get(e){return this._storage.get(this,e)}clear(){this._storage.clearAll()}get maxSize(){return this._storage.maxSize}set maxSize(e){this._storage.maxSize=e}resetHitRate(){}}},57824:(e,t,r)=>{var i,n;r.d(t,{k:()=>n,q:()=>i}),function(e){e[e.ADD=0]="ADD",e[e.UPDATE=1]="UPDATE",e[e.REMOVE=2]="REMOVE"}(i||(i={})),function(e){e[e.NONE=0]="NONE",e[e.VISIBILITY=1]="VISIBILITY",e[e.GEOMETRY=2]="GEOMETRY",e[e.TRANSFORMATION=4]="TRANSFORMATION",e[e.HIGHLIGHT=8]="HIGHLIGHT",e[e.OCCLUDEE=16]="OCCLUDEE"}(n||(n={}))},61157:(e,t,r)=>{r.d(t,{H:()=>p,b:()=>g});var i,n,o=r(57528),a=r(47233),s=r(79138),l=r(21390),c=r(86955),h=r(53908),d=r(70367),u=r(2687);function g(){const e=new u.N5;e.include(a.Q);const{fragment:t}=e;return t.uniforms.add(new d.N("highlightTexture",(e=>e.highlightTexture)),new d.N("highlightOptionsTexture",(e=>e.highlightOptionsTexture)),new l.m("pixelRatio",(e=>e.pixelRatio)),new l.m("occludedIntensityFactor",(e=>e.occludedFactor)),new h.W("maxHighlightLevel",(e=>e.highlights.length-1))),t.constants.add("pixelSampleScale","float",1),e.include(s.y),t.code.add((0,c.H)(i||(i=(0,o.A)(["const float pascal17[9] = float[9](12870.0, 11440.0, 8008.0, 4368.0, 1820.0, 560.0, 120.0, 16.0, 1.0);\nconst float denom17 =  65536.0;\nfloat colorWeight[16] = float[16](0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0);\nfloat colorOcclusion[16] = float[16](0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0);\nfloat weights[16] = float[16](0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0);\nvoid applyTexel(vec2 texel, float weight) {\nif (texel != vec2(0.0)){\nint maxChannel = (maxHighlightLevel >> 2) & 1;\nfor (int channelIndex = 0; channelIndex <= maxChannel; ++channelIndex){\nuint channel = readChannel(texel, channelIndex << 2);\nint firstIndex = channelIndex << 2;\nint maxIndex  = min(firstIndex + 3, maxHighlightLevel);\nfor (int highlightIndex = firstIndex; highlightIndex <= maxIndex; ++highlightIndex ) {\nuint v = readChannelBits(channel, highlightIndex);\nif ((v & 1u) == 1u){\ncolorWeight[highlightIndex] += weight;\nif ((v & 2u) == 2u){\ncolorOcclusion[highlightIndex] += weight;\n}\n}\n}\n}\n}\n}\nvec2 readTexel(ivec2 iuv, int du, int dv) {\nreturn texelFetch(highlightTexture, iuv + ivec2(du, dv), 0).rg;\n}\nvoid readAndApplyTexel(ivec2 iuv, int du, int dv, float weight) {\nvec2 texel = readTexel(iuv, du, dv);\napplyTexel(texel, weight);\n}\nvoid readAndApply2TexelsU(ivec2 iuv, int du, int dv, float weight) {\nreadAndApplyTexel(iuv, -du, dv, weight);\nreadAndApplyTexel(iuv, +du, dv, weight);\n}\nfloat getWeight(int pixelDistance) {\nfloat scaledDistance = float(pixelDistance) * pixelSampleScale / pixelRatio;\nfloat d0f = floor(scaledDistance);\nint d0 = int(d0f);\nif (d0 >= 8){\nreturn 0.0;\n}\nfloat w0 = pascal17[d0];\nfloat w1 = pascal17[d0+1];\nfloat f =  scaledDistance - d0f;\nreturn mix(w0, w1, f);\n}"])))),t.main.add((0,c.H)(n||(n=(0,o.A)(["vec2 highlightTextureSize = vec2(textureSize(highlightTexture,0));\nivec2 iuv = ivec2(sUV * highlightTextureSize);\nvec2 centerTexel = texelFetch(highlightTexture, iuv, 0).rg;\nbool outlinePossible = false;\nif (vOutlinePossible > 0.0){\nfor (int highlightLevel=0; highlightLevel<= maxHighlightLevel; ++highlightLevel) {\nif ((readLevelBits(centerTexel,highlightLevel) & 1u) == 0u) {\noutlinePossible = true;\nbreak;\n}\n}\n}\nif (outlinePossible) {\nint maxPixelDistance = clamp(int(8.0 * pixelRatio / pixelSampleScale), 2, 16);\nfloat weightSum = 0.0;\nfor(int y = 0; y <= maxPixelDistance; ++y) {\nfloat w = getWeight(y);\nweights[y] = w;\nweightSum += w * (y == 0 ? 1.0 : 2.0);\n}\nfor(int y = 0; y <= maxPixelDistance; ++y) {\nweights[y] = weights[y] / weightSum;\n}\nfloat weight0 = weights[0];\napplyTexel(centerTexel, weight0 * weight0);\nfor(int y = 0; y <= maxPixelDistance; y += 1) {\nfloat yFactor = weights[y];\nif (y != 0) {\nfloat xFactor = weight0;\nfloat weight = xFactor * yFactor;\nif (weight > 0.0) {\nreadAndApplyTexel(iuv, 0, +y, weight);\nreadAndApplyTexel(iuv, 0, -y, weight);\n}\n}\nfor(int x = 1; x <= maxPixelDistance; x += 1) {\nfloat xFactor = weights[x];\nfloat weight = xFactor * yFactor;\nif (weight > 0.0) {\nreadAndApply2TexelsU(iuv, x, +y, weight);\nif (y != 0){\nreadAndApply2TexelsU(iuv, x, -y, weight);\n}\n}\n}\n}\n} else {\napplyTexel(centerTexel, 1.0);\n}\nint frontColorIndex = 999;\nint maxColorIndex = 0;\nfor (int i = 0; i <= maxHighlightLevel; ++i) {\nif (colorWeight[i] > 0.0){\nfrontColorIndex = min(frontColorIndex, i);\nmaxColorIndex = max(maxColorIndex, i);\n}\n}\nif (frontColorIndex == 999){\nfragColor = vec4(0.0);\nreturn;\n}\nvec4 accumulatedColor = vec4(0.0);\nfor (int curColorIndex = frontColorIndex; curColorIndex <= maxColorIndex; ++curColorIndex) {\nfloat curColorWeight = colorWeight[curColorIndex];\nif (curColorWeight <= 0.01){\ncontinue;\n}\nuint vc = readLevelBits(centerTexel, curColorIndex);\nbool centerFilled = (vc & 1u) == 1u;\nbool centerOccluded = (vc & 3u) == 3u;\nfloat curColorOcclusion = colorOcclusion[curColorIndex];\nbool occluded = centerFilled ? centerOccluded : curColorOcclusion > 0.5 * curColorWeight;\nint colorChannel = centerFilled ? 0 : 1;\nvec4 colorBase = texelFetch(highlightOptionsTexture, ivec2(curColorIndex, colorChannel), 0);\nfloat occlusionFactor = occluded ? occludedIntensityFactor : 1.0;\nfloat outlineFactor = centerFilled ? 1.0 : smoothstep(0.0, 0.03, curColorWeight);\nfloat intensity = colorBase.a * occlusionFactor * outlineFactor;\nvec3 currentColor = colorBase.rgb;\nfloat a0 = accumulatedColor.a;\nfloat a1 = intensity;\nfloat alpha = clamp(a0 + a1 - a0 * a1, 0.0, 1.0);\nif (alpha > 0.001){\nvec3 blendedColor = ((1.0 - a1) * a0 * accumulatedColor.rgb + a1 * currentColor) / alpha;\naccumulatedColor = vec4(blendedColor, alpha);\n}\n}\nfragColor = accumulatedColor;"])))),e}const p=Object.freeze(Object.defineProperty({__proto__:null,build:g},Symbol.toStringTag,{value:"Module"}))},62361:(e,t,r)=>{r.d(t,{S:()=>v,b:()=>p});var i,n=r(57528),o=r(47233),a=r(79138),s=r(56289),l=r(21390),c=r(86955),h=r(72790),d=r(70367),u=r(21019),g=r(2687);function p(){const e=new g.N5;e.include(o.Q);const{fragment:t}=e;return t.uniforms.add(new d.N("blurInput",(e=>e.singleHighlightBlurTexture)),new s.t("blurSize",(e=>e.blurSize)),new d.N("highlightTexture",(e=>e.highlightTexture)),new d.N("highlightOptionsTexture",(e=>e.highlightOptionsTexture)),new h.c("highlightLevel",(e=>e.highlightLevel)),new l.m("occludedIntensityFactor",(e=>e.occludedFactor))),t.constants.add("inner","float",1-(u.o-u.b)/u.o),e.include(a.y),t.main.add((0,c.H)(i||(i=(0,n.A)(["vec2 highlightTextureSize = vec2(textureSize(highlightTexture,0));\nvec2 uv = sUV;\nvec2 center = texture(blurInput, uv).rg;\nvec2 blurredHighlightValue = (vOutlinePossible == 0.0)\n? center\n: center * 0.204164\n+ texture(blurInput, uv + blurSize * 1.407333).rg * 0.304005\n+ texture(blurInput, uv - blurSize * 1.407333).rg * 0.304005\n+ texture(blurInput, uv + blurSize * 3.294215).rg * 0.093913\n+ texture(blurInput, uv - blurSize * 3.294215).rg * 0.093913;\nfloat highlightIntensity = blurredHighlightValue.r;\nfloat occlusionWeight = blurredHighlightValue.g;\nif (highlightIntensity <= 0.01) {\ndiscard;\n}\nvec4 fillColor    = texelFetch(highlightOptionsTexture, ivec2(highlightLevel, 0), 0);\nvec4 outlineColor = texelFetch(highlightOptionsTexture, ivec2(highlightLevel, 1), 0);\nvec2 centerTexel = texelFetch(highlightTexture, ivec2(uv * highlightTextureSize), 0).rg;\nuint centerBits = readLevelBits(centerTexel, highlightLevel);\nbool centerFilled = (centerBits & 1u) == 1u;\nbool centerOccluded = (centerBits & 3u) == 3u;\nbool occluded = centerOccluded || (0.5 * highlightIntensity < occlusionWeight);\nfloat occlusionFactor = occluded ? occludedIntensityFactor : 1.0;\nfloat outlineFactor = centerFilled ? 1.0 : smoothstep(0.0, inner, highlightIntensity);\nfloat fillFactor = centerFilled ? 1.0 : 0.0;\nvec4 baseColor = mix(outlineColor, fillColor, fillFactor);\nfloat intensity = baseColor.a * occlusionFactor * outlineFactor;\nfragColor = vec4(baseColor.rgb, intensity);"])))),e}const v=Object.freeze(Object.defineProperty({__proto__:null,build:p},Symbol.toStringTag,{value:"Module"}))},62854:(e,t,r)=>{r.d(t,{H:()=>u,b:()=>d});var i,n=r(57528),o=r(47233),a=r(79138),s=r(86955),l=r(72790),c=r(70367),h=r(2687);function d(){const e=new h.N5;e.include(o.Q),e.include(a.y);const{fragment:t}=e;return e.outputs.add("fragSingleHighlight","vec2",0),t.uniforms.add(new c.N("highlightTexture",(e=>e.highlightTexture)),new l.c("highlightLevel",(e=>e.highlightLevel))),t.main.add((0,s.H)(i||(i=(0,n.A)(["ivec2 iuv = ivec2(gl_FragCoord.xy);\nvec2 inputTexel = texelFetch(highlightTexture, iuv, 0).rg;\nuint bits = readLevelBits(inputTexel, highlightLevel);\nbool hasHighlight = (bits & 1u) == 1u;\nbool hasOccluded  = (bits & 2u) == 2u;\nfragSingleHighlight = vec2(hasHighlight ? 1.0 : 0.0, hasOccluded ? 1.0 : 0.0);"])))),e}const u=Object.freeze(Object.defineProperty({__proto__:null,build:d},Symbol.toStringTag,{value:"Module"}))},63401:(e,t,r)=>{r.d(t,{c:()=>i,n:()=>v});var i,n=r(4212),o=r(15941),a=r(75540),s=r(34761),l=r(13191),c=r(20664),h=r(9392),d=r(52896),u=r(14556),g=r(51977),p=r(317);class v{constructor(){this.startTime=0,this._data=(0,a.v)(null),this._readChannels=g.c.RG,this.parallax=new f,this.parallaxNew=new f,this._anchorPoint=(0,h.vt)(),this._fadeState=(0,a.v)(i.HIDE),this._fadeFactor=(0,a.v)(1)}get data(){return this._data.value}set data(e){this._data.value=e}get readChannels(){return this._readChannels}get fadeState(){return this._fadeState.value}get fadeFactor(){return this._fadeFactor.value}get opacity(){switch(this.fadeState){case i.HIDE:return 0;case i.FADE_OUT:return 1-this.fadeFactor;case i.FADE_IN:return this.fadeFactor;case i.SHOW:case i.CROSS_FADE:return 1}}fade(e,t,r){this.isFading&&this.fadeFactor<1&&(this._fadeFactor.value=r?(0,o.qE)((t-this.startTime)/(y*r),0,1):1,1===this.fadeFactor&&this._endFade()),this._evaluateState(e,t),this._updateParallax(e)}_evaluateState(e,t){const r=e.relativeElevation,n=this._updateAnchorPoint(e);(r>1.7*p.zF||r<-1e4||n>C)&&this.opacity>0?this._startFade(i.HIDE,t):this.isFading||(r>p.zF||r<-.35*p.zF||n>w*C?this.opacity>0&&this._startFade(i.FADE_OUT,t):(0,g.pi)(this.data)&&(0===this.opacity?this._startFade(i.FADE_IN,t):this.data.state===g.tf.Ready&&(this.fadeState===i.SHOW?this._startFade(i.CROSS_FADE,t):this._startFade(i.SHOW,t))))}_updateParallax(e){const t=(0,c.k)(e.eye);this.parallax.radiusCurvatureCorrection=.84*Math.sqrt(Math.max(t-u.$O.radius*u.$O.radius,0))/Math.sqrt(t),(0,d.Cr)(_,this.parallax.anchorPoint,m),(0,s.e$)(this.parallax.transform,l.zK,m[3],(0,d.yo)(m)),(0,d.Cr)(_,this.parallaxNew.anchorPoint,m),(0,s.e$)(this.parallaxNew.transform,l.zK,m[3],(0,d.yo)(m))}_updateAnchorPoint(e){var t;return(0,c.n)(this._anchorPoint,e.eye),(0,c.h)(this._anchorPoint,this._anchorPoint,u.$O.radius),this.fadeState===i.HIDE&&(null===(t=this.data)||void 0===t?void 0:t.state)===g.tf.Ready?((0,c.c)(this.parallax.anchorPoint,this._anchorPoint),0):(0,c.l)((0,c.d)(x,this.parallax.anchorPoint,this._anchorPoint))}requestFade(){this._fadeFactor.value=0}_startFade(e,t){switch(this._fadeState.value=e,this.startTime=t,e){case i.CROSS_FADE:this.requestFade(),this._switchReadChannels(),(0,c.c)(this.parallaxNew.anchorPoint,this._anchorPoint);break;case i.FADE_IN:this.requestFade(),this._switchReadChannels(),(0,c.c)(this.parallax.anchorPoint,this._anchorPoint),(0,c.c)(this.parallaxNew.anchorPoint,this._anchorPoint);break;case i.FADE_OUT:this.requestFade();break;case i.SHOW:this._switchReadChannels(),(0,c.c)(this.parallax.anchorPoint,this._anchorPoint),(0,c.c)(this.parallaxNew.anchorPoint,this._anchorPoint),this._endFade();break;case i.HIDE:this._endFade()}}_endFade(){switch(this._fadeFactor.value=1,this.data&&this.data.state!==g.tf.Ready&&(this.data.state=g.tf.Idle),this.fadeState){case i.CROSS_FADE:(0,c.c)(this.parallax.anchorPoint,this.parallaxNew.anchorPoint),this._fadeState.value=i.SHOW;break;case i.FADE_IN:this._fadeState.value=i.SHOW;break;case i.FADE_OUT:this._fadeState.value=i.HIDE;break;case i.SHOW:case i.HIDE:break;default:(0,n.Xb)(this.fadeState)}}_switchReadChannels(){var e;(null===(e=this.data)||void 0===e?void 0:e.state)===g.tf.Ready&&(this._readChannels=1-this._readChannels,this.data.state=g.tf.Fading)}get isFading(){return this.fadeState===i.FADE_OUT||this.fadeState===i.FADE_IN||this.fadeState===i.CROSS_FADE}}!function(e){e[e.HIDE=0]="HIDE",e[e.FADE_IN=1]="FADE_IN",e[e.SHOW=2]="SHOW",e[e.CROSS_FADE=3]="CROSS_FADE",e[e.FADE_OUT=4]="FADE_OUT"}(i||(i={}));class f{constructor(){this.anchorPoint=(0,h.vt)(),this.radiusCurvatureCorrection=0,this.transform=(0,l.vt)()}}const _=(0,h.fA)(0,0,1),m=(0,d.vt)(),x=(0,h.vt)(),y=1.25,w=.5,C=2e5},63928:(e,t,r)=>{r.d(t,{W:()=>o});var i=r(45463),n=r(48168);class o extends i.im{intersect(e,t,r,i,o,a){return(0,n.Uy)(e,r,i,o,void 0,a)}}},70558:(e,t,r)=>{r.d(t,{bi:()=>Dt});var i,n=r(89379),o=r(35143),a=r(54099),s=r(81806),l=r(87663),c=r(30726),h=r(30015),d=r(68134),u=r(41289),g=r(46053),p=r(76460),v=(r(47249),r(85842)),f=r(34761),_=r(20664),m=r(9392),x=r(57662),y=r(22955),w=r(19539),C=r(2413),b=r(75507);class T{constructor(){this._extent=(0,C.vt)(),this.resolution=0,this.renderLocalOrigin=(0,b.f)(0,0,0,"O"),this.pixelRatio=1,this.mapUnitsPerPixel=1,this.canvasGeometries=new S}get extent(){return this._extent}setupGeometryViewsCyclical(e){this.setupGeometryView();const t=.001*e.range;if(this._extent[0]-t<=e.min){const t=this.canvasGeometries.extents[this.canvasGeometries.numViews++];(0,C.cY)(this._extent,e.range,0,t)}if(this._extent[2]+t>=e.max){const t=this.canvasGeometries.extents[this.canvasGeometries.numViews++];(0,C.cY)(this._extent,-e.range,0,t)}}setupGeometryView(){this.canvasGeometries.numViews=1,(0,C.C)(this.canvasGeometries.extents[0],this._extent)}hasSomeSizedView(){for(let e=0;e<this.canvasGeometries.numViews;e++){const t=this.canvasGeometries.extents[e];if(t[0]!==t[2]&&t[1]!==t[3])return!0}return!1}}class S{constructor(){this.extents=[(0,C.vt)(),(0,C.vt)(),(0,C.vt)()],this.numViews=0}}!function(e){e[e.Color=0]="Color",e[e.ColorNoRasterImage=1]="ColorNoRasterImage",e[e.Highlight=2]="Highlight",e[e.WaterNormal=3]="WaterNormal",e[e.Occluded=4]="Occluded",e[e.ObjectAndLayerIdColor=5]="ObjectAndLayerIdColor"}(i||(i={}));class O{constructor(e,t,r){this._fbos=e,this._format=t,this._name=r}get valid(){var e;return null!=(null===(e=this._handle)||void 0===e?void 0:e.getTexture())}dispose(){this._handle=(0,c.Gz)(this._handle)}get texture(){var e;return null===(e=this._handle)||void 0===e?void 0:e.getTexture()}bind(e,t,r){var i,n,o,a;this._handle&&(null===(i=this._handle.fbo)||void 0===i?void 0:i.width)===t&&(null===(n=this._handle.fbo)||void 0===n?void 0:n.height)===r||(null!==(o=this._handle)&&void 0!==o&&o.release(),this._handle=this._fbos.acquire(t,r,this._name,this._format)),e.bindFramebuffer(null===(a=this._handle)||void 0===a?void 0:a.fbo)}generateMipMap(){var e,t;(null===(e=this._handle)||void 0===e||null===(e=e.getTexture())||void 0===e||null===(e=e.descriptor)||void 0===e?void 0:e.hasMipmap)&&(null===(t=this._handle)||void 0===t||null===(t=t.getTexture())||void 0===t||t.generateMipmap())}}var R=r(16455),D=r(34981),P=r(61785);class I{constructor(e,t,r,i){let n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:R.N.RGBA_MIPMAP;this.output=r,this.content=i,this.fbo=new O(e,n,t)}get valid(){return this.fbo.valid}}class A{constructor(e){this.targets=[new I(e,"overlay color",D.V.Color,i.Color),new I(e,"overlay IM color",D.V.Color,i.ColorNoRasterImage),new I(e,"overlay highlight",D.V.Highlight,i.Highlight,R.N.RG),new I(e,"overlay water",D.V.Normal,i.WaterNormal),new I(e,"overlay occluded",D.V.Color,i.Occluded)],(0,P.E)()&&this.targets.push(new I(e,"overlay olid",D.V.ObjectAndLayerIdColor,i.ObjectAndLayerIdColor,R.N.RGBA))}getTexture(e){var t;return null===(t=this.targets[e])||void 0===t?void 0:t.fbo.texture}dispose(){for(const e of this.targets)e.fbo.dispose()}computeValidity(){return this.targets.reduce(((e,t,r)=>t.valid?e|=1<<r:e),0)}}var M,E=r(57583),F=r(55855);!function(e){e[e.Material=0]="Material",e[e.ShadowMap=1]="ShadowMap",e[e.Highlight=2]="Highlight",e[e.ViewshedShadowMap=3]="ViewshedShadowMap"}(M||(M={}));r(43557),r(26719),r(9001),r(20123),r(21390),r(86955),r(70367);var N,H=r(87003);!function(e){e[e.Disabled=0]="Disabled",e[e.Enabled=1]="Enabled",e[e.EnabledWithWater=2]="EnabledWithWater",e[e.COUNT=3]="COUNT"}(N||(N={}));(0,F.vt)();H.n;var L=r(53070),z=r(60586),V=r(19555),W=r(90364),j=r(36451),U=r(16506),G=r(59246),q=r(61157),B=r(57162);class k extends G.w{constructor(e,t){super(e,t,new U.$(q.H,(()=>r.e(2671).then(r.bind(r,82671)))))}initializePipeline(){return(0,B.Ey)({blending:B.Ky,colorWrite:B.kn})}}var Z=r(21019);class Q extends G.w{constructor(e,t){super(e,t,new U.$(Z.a,(()=>r.e(1521).then(r.bind(r,51521)))))}initializePipeline(){return(0,B.Ey)({colorWrite:B.kn})}}var $=r(1723),Y=r(31432);class X extends Y.Y{constructor(){super(...arguments),this.occludedFactor=$.cD,this.verticalCellCount=0,this.horizontalCellCount=0,this.highlightLevel=0,this.pixelRatio=1}}var K=r(62854);class J extends G.w{constructor(e,t){super(e,t,new U.$(K.H,(()=>r.e(7932).then(r.bind(r,37932)))))}initializePipeline(){return(0,B.Ey)({colorWrite:B.kn})}}var ee=r(62361);class te extends G.w{constructor(e,t){super(e,t,new U.$(ee.S,(()=>r.e(8231).then(r.bind(r,58231)))))}initializePipeline(){return(0,B.Ey)({blending:B.Ky,colorWrite:B.kn})}}var re=r(51542);class ie extends G.w{constructor(e,t){super(e,t,new U.$(re.a,(()=>r.e(5880).then(r.bind(r,85880)))))}initializePipeline(){return(0,B.Ey)({colorWrite:B.kn})}}var ne=r(83490),oe=r(32119),ae=r(11850),se=r(69008),le=r(76718),ce=r(93345),he=r(80895),de=r(96673);let ue=class extends j.A{constructor(){super(...arguments),this.produces=W.OG.HIGHLIGHTS,this.consumes={required:[W.OG.HIGHLIGHTS,"highlights"]},this._useMultipleHighlights=!1,this._downsampleDrawParameters=new Z.H,this._passParameters=new X,this._singleHighlightBlurDrawParameters=new re.S,this._grid=new ge}initialize(){this.addHandles([(0,d.wB)((()=>this._updateOptionsTexture()),(()=>{}),d.Vh)])}destroy(){this._grid.coverage=(0,c.Gz)(this._grid.coverage),this._grid.vao=(0,c.WD)(this._grid.vao),this._passParameters.highlightOptionsTexture=(0,c.Gz)(this._passParameters.highlightOptionsTexture)}_updateOptionsTexture(){if(null==this._passParameters.highlightOptionsTexture){const e=new de.R(16,2);e.internalFormat=ce.Ab.RGBA,e.samplingMode=ce.Cj.NEAREST,this._passParameters.highlightOptionsTexture=new he.g(this.renderingContext,e,null)}this._passParameters.highlightOptionsTexture.setData(function(e){const t=new Uint8Array(128);let r=0;for(const n of e){var i;const e=4*r,o=4*r+64;++r;const{color:a}=n,s=null!==(i=n.haloColor)&&void 0!==i?i:a;t[e+0]=a.r,t[e+1]=a.g,t[e+2]=a.b,t[e+3]=n.fillOpacity*a.a*255,t[o+0]=s.r,t[o+1]=s.g,t[o+2]=s.b,t[o+3]=n.haloOpacity*s.a*255}return t}(this.view.state.highlights)),this.requestRender(ne.C7.UPDATE)}precompile(){this.techniques.precompile(Q),this._useMultipleHighlights?this.techniques.precompile(k):(this.techniques.precompile(J),this.techniques.precompile(ie),this.techniques.precompile(te))}render(e){const t=e.find((e=>{let{name:t}=e;return t===W.OG.HIGHLIGHTS})),{techniques:r,bindParameters:i,_passParameters:n,renderingContext:o}=this;if(!i.decorations)return t;const a=r.get(Q);if(!a.compiled)return this.requestRender(ne.C7.UPDATE),t;const s=e.find((e=>{let{name:t}=e;return"highlights"===t})).getTexture(),l=()=>{var e;this._gridUpdateResources(s);const t=this._gridComputeCoverage(a,s,i),{horizontalCellCount:r,verticalCellCount:o}=t;return n.horizontalCellCount=r,n.verticalCellCount=o,n.coverageTexture=null===(e=t.coverage)||void 0===e?void 0:e.getTexture(),t},c=e=>{const t=e.verticalCellCount*e.horizontalCellCount;o.bindVAO(e.vao),o.drawElementsInstanced(ce.WR.TRIANGLES,6,ce.pe.UNSIGNED_BYTE,0,t)},{camera:h}=i,d=()=>{o.bindFramebuffer(t.fbo),o.setViewport4fv(h.fullViewport)};return this._useMultipleHighlights?this._renderMultiple(s,l,c,d):this._renderSingle(s,l,c,d),n.highlightTexture=null,n.coverageTexture=null,t}_renderMultiple(e,t,r,i){const{techniques:n,bindParameters:o,_passParameters:a,renderingContext:s}=this,l=n.get(k);if(!l.compiled)return void this.requestRender(ne.C7.UPDATE);const c=t();a.highlightTexture=e,a.pixelRatio=o.camera.pixelRatio,s.bindTechnique(l,o,a),i(),r(c)}_renderSingle(e,t,r,i){const{fboCache:n,techniques:o,bindParameters:a,_passParameters:s,renderingContext:l}=this,c=o.get(J),h=o.get(ie),d=o.get(te);if(!d.compiled||!h.compiled||!c.compiled)return void this.requestRender(ne.C7.UPDATE);const u=t(),{width:g,height:p}=e.descriptor;s.highlightTexture=e;const{camera:v}=a,{fullWidth:f,fullHeight:_,pixelRatio:m}=v,x=Math.ceil(f/m),y=Math.ceil(_/m),{_singleHighlightBlurDrawParameters:w}=this,C=this.view._stage.renderView.renderer,{highlights:b}=a;for(let S=0;S<b.length;++S){var T;const{name:e}=b[S];if(!C.hasHighlightOptions(e))continue;s.highlightLevel=S,l.setClearColor(0,0,0,0);const t=n.acquire(g,p,"single highlight",R.N.RG);l.bindFramebuffer(t.fbo),l.setViewport(0,0,g,p),l.clear(ce.NV.COLOR),l.bindTechnique(c,a,s),r(u),w.blurInput=t.getTexture(),(0,V.hZ)(w.blurSize,1/x,0);const o=n.acquire(x,y,"single highlight blur h",R.N.RG);l.unbindTexture(null===(T=o.fbo)||void 0===T?void 0:T.colorTexture),l.bindFramebuffer(o.fbo),l.setViewport(0,0,x,y),l.clear(ce.NV.COLOR),l.bindTechnique(h,a,s,w),r(u),t.release(),(0,V.hZ)(w.blurSize,0,1/y),s.singleHighlightBlurTexture=o.getTexture(),i(),l.bindTechnique(d,a,s,w),r(u),o.release()}}_gridUpdateResources(e){const t=this._grid,{width:r,height:i}=e.descriptor;if(t.horizontalCellCount=Math.ceil(r/Z.g),t.verticalCellCount=Math.ceil(i/Z.g),t.vao)return;const n=this.renderingContext,o=le.g.createIndex(n,ce._U.STATIC_DRAW,ve);t.vao=new se.Z(n,oe.D,new Map([["geometry",ae.wR]]),new Map([["geometry",le.g.createVertex(n,ce._U.STATIC_DRAW)]]),o)}_gridComputeCoverage(e,t,r){var i;const n=this.renderingContext,o=this._grid,a=t.descriptor,s=Math.ceil(a.width/Z.g),l=Math.ceil(a.height/Z.g);this._downsampleDrawParameters.input=t,null===(i=o.coverage)||void 0===i||i.release();const c=this.fboCache.acquire(s,l,"highlight coverage",R.N.RG);return o.coverage=c,n.bindFramebuffer(c.fbo),n.bindTechnique(e,r,this._passParameters,this._downsampleDrawParameters),n.setViewport(0,0,s,l),n.screen.draw(),o}get test(){}};(0,o._)([(0,g.MZ)()],ue.prototype,"produces",void 0),(0,o._)([(0,g.MZ)()],ue.prototype,"consumes",void 0),ue=(0,o._)([(0,v.$)("esri.views.3d.webgl-engine.effects.highlight.Highlight")],ue);class ge{constructor(){this.coverage=null,this.vao=null,this.verticalCellCount=0,this.horizontalCellCount=0,this.viewportWidth=0,this.viewportHeight=0}}let pe=0;const ve=new Uint8Array([0,1,2,2,1,3]);var fe=r(75941),_e=r(86994);class me{constructor(e,t,r,i){this._textures=e,this._techniques=t,this.materialChanged=r,this.requestRender=i,this._id2glMaterialRef=new fe.O}dispose(){this._textures.destroy()}acquire(e,t,r){this._ownMaterial(e);const i=e.produces.get(t);if(null===i||void 0===i||!i(r))return null;let n=this._id2glMaterialRef.get(r,e.id);if(null==n){const t=e.createGLMaterial({material:e,techniques:this._techniques,textures:this._textures,output:r});n=new xe(t),this._id2glMaterialRef.set(r,e.id,n)}return n.ref(),n.glMaterial}release(e,t){const r=this._id2glMaterialRef.get(t,e.id);null!=r&&(r.unref(),r.referenced||((0,c.WD)(r.glMaterial),this._id2glMaterialRef.delete(t,e.id)))}_ownMaterial(e){e.repository&&e.repository!==this&&p.A.getLogger("esri.views.3d.webgl-engine.lib.GLMaterialRepository").error("Material is already owned by a different material repository"),e.repository=this}}class xe{constructor(e){this.glMaterial=e,this._refCnt=0}ref(){++this._refCnt}unref(){--this._refCnt,(0,_e.vA)(this._refCnt>=0)}get referenced(){return this._refCnt>0}}var ye,we=r(97583),Ce=r(45463),be=r(72001),Te=(r(91417),r(13191)),Se=r(72745),Oe=r(63401),Re=r(98521),De=r(77730);!function(e){e[e.Immediate=0]="Immediate",e[e.FadeWithWeather=1]="FadeWithWeather"}(ye||(ye={}));var Pe=r(4998);class Ie{constructor(e){this.shadowMap=e,this.slot=De.N.OPAQUE_MATERIAL,this.slicePlane=null,this.hasOccludees=!1,this.enableFillLights=!0,this.oitPass=be.Y.NONE,this.alignPixelEnabled=!1,this.decorations=!0,this.overlayStretch=1,this.viewshedEnabled=!1,this._camera=new E.A,this._inverseViewport=(0,Se.vt)(),this._oldLighting=new Pe.TA,this._newLighting=new Pe.TA,this._fadedLighting=new Pe.TA,this._lighting=this._newLighting,this.ssr=new Ae,this.terrainDepthTest=!1,this.cullAboveTerrain=!1,this.highlights=new Array,this.highlightOrderMap=new Map,this.highlightMixOrigin=(0,Se.vt)(),this.highlightMixTexture=null,this.hudRenderStyle=Re.D.Occluded,this.hudOccludedFragmentOpacity=1,this.clouds=new Oe.n,this.shadowHighlightsVisible=!1}get camera(){return this._camera}set camera(e){this._camera=e,this._inverseViewport[0]=1/e.fullViewport[2],this._inverseViewport[1]=1/e.fullViewport[3]}get inverseViewport(){return this._inverseViewport}get lighting(){return this._lighting}fadeLighting(){switch(this.clouds.fadeFactor){case 0:this._lighting=this._oldLighting;break;default:this._fadedLighting.lerpLighting(this._oldLighting,this._newLighting,this.clouds.fadeFactor),this._lighting=this._fadedLighting;break;case 1:this._lighting=this._newLighting,this._oldLighting.copyFrom(this._newLighting)}}updateLighting(e,t,r,i){this._oldLighting.copyFrom(this.lighting),this._newLighting.noonFactor=t,this._newLighting.globalFactor=r,this._newLighting.set(e),i===ye.FadeWithWeather&&this.clouds.requestFade(),this.fadeLighting()}get highlight(){return null==this.highlightLevel?null:this.highlights[this.highlightLevel]}}class Ae{constructor(){this.fadeFactor=1,this.reprojectionMatrix=(0,Te.vt)()}}class Me{constructor(e,t){this.rctx=e,this.lastFrameCamera=new E.A,this.output=D.V.Color,this.renderOccludedMask=Ee,this.bind=new Ie(t),this.bind.alignPixelEnabled=!0}}const Ee=Ce.m$.Occlude|Ce.m$.OccludeAndTransparent|Ce.m$.OccludeAndTransparentStencil;var Fe=r(15941),Ne=r(44680),He=r(43047),Le=r(64465);let ze=class extends E.A{constructor(){super(...arguments),this._projectionMatrix=(0,Te.vt)()}get projectionMatrix(){return this._projectionMatrix}};(0,o._)([(0,g.MZ)()],ze.prototype,"_projectionMatrix",void 0),(0,o._)([(0,g.MZ)({readOnly:!0})],ze.prototype,"projectionMatrix",null),ze=(0,o._)([(0,v.$)("esri.views.3d.webgl-engine.lib.CascadeCamera")],ze);var Ve,We=r(81330);!function(e){e[e.Highlight=0]="Highlight",e[e.ExcludeHighlight=1]="ExcludeHighlight"}(Ve||(Ve={}));class je{constructor(){this.camera=new ze,this.lightMat=(0,Te.vt)()}}class Ue{constructor(){this.maxNumCascadesHighQuality=4,this.maxNumCascadesLowQuality=4,this.textureSizeModHighQuality=1.3,this.textureSizeModLowQuality=.9,this.splitSchemeLambda=0}}class Ge{constructor(e,t){this._fbos=e,this._viewingMode=t,this._enabled=!1,this._snapshots=new Array,this._textureHeight=0,this._numCascades=1,this.settings=new Ue,this._projectionView=(0,Te.vt)(),this._projectionViewInverse=(0,Te.vt)(),this._modelViewLight=(0,Te.vt)(),this._cascadeDistances=[0,0,0,0,0],this._usedCascadeDistances=(0,F.vt)(),this._cascades=[new je,new je,new je,new je],this._lastOrigin=null,this._maxTextureWidth=Math.min((0,s.A)("esri-mobile")?4096:16384,e.rctx.parameters.maxTextureSize)}dispose(){this.enabled=!1,this.disposeOffscreenBuffers()}get depthTexture(){var e;return null===(e=this._handle)||void 0===e?void 0:e.getTexture()}get _textureWidth(){return this._textureHeight*this._numCascades}get numCascades(){return this._numCascades}get cascadeDistances(){return(0,He.s)(this._usedCascadeDistances,this._cascadeDistances[0],this._numCascades>1?this._cascadeDistances[1]:1/0,this._numCascades>2?this._cascadeDistances[2]:1/0,this._numCascades>3?this._cascadeDistances[3]:1/0)}disposeOffscreenBuffers(){this._handle=(0,c.Gz)(this._handle),this._discardSnapshots()}set maxCascades(e){this.settings.maxNumCascadesHighQuality=(0,Fe.qE)(Math.floor(e),1,4)}get maxCascades(){return this.settings.maxNumCascadesHighQuality}set enabled(e){this._enabled=e,e||this.disposeOffscreenBuffers()}get enabled(){return this._enabled}get ready(){return this._enabled&&null!=this.depthTexture}get cascades(){for(let e=0;e<this._numCascades;++e)Je[e]=this._cascades[e];return Je.length=this._numCascades,Je}start(e,t,r,i,n){(0,_e.vA)(this.enabled);const{near:o,far:a}=function(e){let{near:t,far:r}=e;return t<2&&(t=2),r<2&&(r=2),t>=r&&(t=2,r=4),{near:t,far:r}}(r);this._computeCascadeDistances(o,a,i),this._textureHeight=this._computeTextureHeight(e,n,i),this._setupMatrices(e,t);const{viewMatrix:s,projectionMatrix:l}=e;for(let c=0;c<this._numCascades;++c)this._constructCascade(c,l,s,t);this._lastOrigin=null,this.clear()}finish(){var e;(0,_e.vA)(this.enabled),null===(e=this._handle)||void 0===e||e.detachDepth()}getShadowMapMatrices(e){if(!this._lastOrigin||!(0,_.p)(e,this._lastOrigin)){this._lastOrigin=this._lastOrigin||(0,m.vt)(),(0,_.c)(this._lastOrigin,e);for(let t=0;t<this._numCascades;++t){(0,f.Tl)(et,this._cascades[t].lightMat,e);for(let e=0;e<16;++e)tt[16*t+e]=et[e]}}return tt}moveSnapshot(e){var t,r;(0,_e.vA)(this.enabled),null!==(t=this._handle)&&void 0!==t&&t.detachDepth(),null!==(r=this._snapshots[e])&&void 0!==r&&r.release(),this._snapshots[e]=this._handle,this._handle=null,this.clear()}copySnapshot(e){var t,r,i;const n=null===(t=this._handle)||void 0===t||null===(t=t.getTexture())||void 0===t?void 0:t.descriptor;if(!this.enabled||!n)return;null===(r=this._snapshots[e])||void 0===r||r.release();const{width:o,height:a}=n,s=e===Ve.Highlight?"shadow highlight snapshot":"shadow no highlight snapshot";this._snapshots[e]=this._fbos.acquire(o,a,s,R.N.RGBA4);const l=this._fbos.rctx;this._bindFbo();const c=l.bindTexture(null===(i=this._snapshots[e])||void 0===i?void 0:i.getTexture(),he.g.TEXTURE_UNIT_FOR_UPDATES);l.gl.copyTexSubImage2D(ce.Ap.TEXTURE_2D,0,0,0,0,0,o,a),l.bindTexture(c,he.g.TEXTURE_UNIT_FOR_UPDATES)}getSnapshot(e){var t;return this.enabled?null===(t=this._snapshots[e])||void 0===t?void 0:t.getTexture():null}clear(){const e=this._fbos.rctx;this._ensureFbo(),this._bindFbo(),e.setClearColor(1,1,1,1),e.clear(ce.NV.COLOR|ce.NV.DEPTH)}_computeTextureHeight(e,t,r){const i=Math.min(window.devicePixelRatio,t)/e.pixelRatio,n=r?this.settings.textureSizeModHighQuality:this.settings.textureSizeModLowQuality,o=(0,We.Mv)(Math.floor(Math.max(e.fullWidth,e.fullHeight)*i*n)),a=Math.min(this._maxTextureWidth,this._numCascades*o);return(0,We.uT)(a/this._numCascades)}_ensureFbo(){var e,t,r,i;(null===(e=this._handle)||void 0===e||null===(e=e.fbo)||void 0===e?void 0:e.width)===this._textureWidth&&(null===(t=this._handle)||void 0===t?void 0:t.fbo.height)===this._textureHeight||(null!==(r=this._handle)&&void 0!==r&&r.release(),this._handle=this._fbos.acquire(this._textureWidth,this._textureHeight,"shadow map",R.N.RGBA4)),null===(i=this._handle)||void 0===i||i.acquireDepth(R.z.DEPTH16_BUFFER)}_discardSnapshot(e){this._snapshots[e]=(0,c.Gz)(this._snapshots[e])}_discardSnapshots(){for(let e=0;e<this._snapshots.length;++e)this._discardSnapshot(e);this._snapshots.length=0}_bindFbo(){var e;this._fbos.rctx.bindFramebuffer(null===(e=this._handle)||void 0===e?void 0:e.fbo)}_constructCascade(e,t,r,i){const n=this._cascades[e],o=-this._cascadeDistances[e],a=-this._cascadeDistances[e+1],s=(t[10]*o+t[14])/Math.abs(t[11]*o+t[15]),l=(t[10]*a+t[14])/Math.abs(t[11]*a+t[15]);(0,_e.vA)(s<l);for(let u=0;u<8;++u){(0,He.s)(Be,u%4==0||u%4==3?-1:1,u%4==0||u%4==1?-1:1,u<4?s:l,1);const e=ke[u];(0,He.t)(e,Be,this._projectionViewInverse),e[0]/=e[3],e[1]/=e[3],e[2]/=e[3]}(0,_.v)(Ke,ke[0]),n.camera.viewMatrix=(0,f.Tl)(qe,this._modelViewLight,Ke);for(let u=0;u<8;++u)(0,_.t)(ke[u],ke[u],n.camera.viewMatrix);let c=ke[0][2],h=ke[0][2];for(let u=1;u<8;++u)c=Math.min(c,ke[u][2]),h=Math.max(h,ke[u][2]);c-=200,h+=200,n.camera.near=-h,n.camera.far=-c,function(e,t,r,i,n){const o=1/ke[0][3],a=1/ke[4][3];(0,_e.vA)(o<a);let s=o+Math.sqrt(o*a);const l=Math.sin((0,Fe.XM)(e[2]*t[0]+e[6]*t[1]+e[10]*t[2]));s/=l,function(e,t,r,i,n,o,a,s){(0,V.hZ)(rt,0,0);for(let w=0;w<4;++w)(0,V.WQ)(rt,rt,e[w]);(0,V.hs)(rt,rt,.25),(0,V.hZ)(it,0,0);for(let w=4;w<8;++w)(0,V.WQ)(it,it,e[w]);(0,V.hs)(it,it,.25),(0,V.Cc)(nt[0],e[4],e[5],.5),(0,V.Cc)(nt[1],e[5],e[6],.5),(0,V.Cc)(nt[2],e[6],e[7],.5),(0,V.Cc)(nt[3],e[7],e[4],.5);let l=0,c=(0,V.hG)(nt[0],rt);for(let w=1;w<4;++w){const e=(0,V.hG)(nt[w],rt);e<c&&(c=e,l=w)}(0,V.Re)(ot,nt[l],e[l+4]);const h=ot[0];let d,u;ot[0]=-ot[1],ot[1]=h,(0,V.Re)(at,it,rt),(0,V.Om)(at,ot)<0&&(0,V.ze)(ot,ot),(0,V.Cc)(ot,ot,at,r),(0,V.S8)(ot,ot),d=u=(0,V.Om)((0,V.Re)(st,e[0],rt),ot);for(let w=1;w<8;++w){const t=(0,V.Om)((0,V.Re)(st,e[w],rt),ot);t<d?d=t:t>u&&(u=t)}(0,V.C)(i,rt),(0,V.hs)(st,ot,d-t),(0,V.WQ)(i,i,st);let g=-1,p=1,v=0,f=0;for(let w=0;w<8;++w){(0,V.Re)(lt,e[w],i),(0,V.S8)(lt,lt);const t=ot[0]*lt[1]-ot[1]*lt[0];t>0?t>g&&(g=t,v=w):t<p&&(p=t,f=w)}(0,_e.MX)(g>0,"leftArea"),(0,_e.MX)(p<0,"rightArea"),(0,V.hs)(ct,ot,d),(0,V.WQ)(ct,ct,rt),(0,V.hs)(ht,ot,u),(0,V.WQ)(ht,ht,rt),dt[0]=-ot[1],dt[1]=ot[0];const _=(0,_e.L)(i,e[f],ht,(0,V.WQ)(st,ht,dt),1,n),m=(0,_e.L)(i,e[v],ht,st,1,o),x=(0,_e.L)(i,e[v],ct,(0,V.WQ)(st,ct,dt),1,a),y=(0,_e.L)(i,e[f],ct,st,1,s);(0,_e.MX)(_,"rayRay"),(0,_e.MX)(m,"rayRay"),(0,_e.MX)(x,"rayRay"),(0,_e.MX)(y,"rayRay")}(ke,s,l,Ze,Qe,$e,Ye,Xe),function(e,t,r,i,n){(0,V.Re)(vt,r,i),(0,V.hs)(vt,vt,.5),ft[0]=vt[0],ft[1]=vt[1],ft[2]=0,ft[3]=vt[1],ft[4]=-vt[0],ft[5]=0,ft[6]=vt[0]*vt[0]+vt[1]*vt[1],ft[7]=vt[0]*vt[1]-vt[1]*vt[0],ft[8]=1,ft[ut(0,2)]=-(0,V.Om)(pt(ft,0),e),ft[ut(1,2)]=-(0,V.Om)(pt(ft,1),e);let o=(0,V.Om)(pt(ft,0),r)+ft[ut(0,2)],a=(0,V.Om)(pt(ft,1),r)+ft[ut(1,2)],s=(0,V.Om)(pt(ft,0),i)+ft[ut(0,2)],l=(0,V.Om)(pt(ft,1),i)+ft[ut(1,2)];o=-(o+s)/(a+l),ft[ut(0,0)]+=ft[ut(1,0)]*o,ft[ut(0,1)]+=ft[ut(1,1)]*o,ft[ut(0,2)]+=ft[ut(1,2)]*o,o=1/((0,V.Om)(pt(ft,0),r)+ft[ut(0,2)]),a=1/((0,V.Om)(pt(ft,1),r)+ft[ut(1,2)]),ft[ut(0,0)]*=o,ft[ut(0,1)]*=o,ft[ut(0,2)]*=o,ft[ut(1,0)]*=a,ft[ut(1,1)]*=a,ft[ut(1,2)]*=a,ft[ut(2,0)]=ft[ut(1,0)],ft[ut(2,1)]=ft[ut(1,1)],ft[ut(2,2)]=ft[ut(1,2)],ft[ut(1,2)]+=1,o=(0,V.Om)(pt(ft,1),t)+ft[ut(1,2)],a=(0,V.Om)(pt(ft,2),t)+ft[ut(2,2)],s=(0,V.Om)(pt(ft,1),r)+ft[ut(1,2)],l=(0,V.Om)(pt(ft,2),r)+ft[ut(2,2)],o=-.5*(o/a+s/l),ft[ut(1,0)]+=ft[ut(2,0)]*o,ft[ut(1,1)]+=ft[ut(2,1)]*o,ft[ut(1,2)]+=ft[ut(2,2)]*o,o=(0,V.Om)(pt(ft,1),t)+ft[ut(1,2)],a=(0,V.Om)(pt(ft,2),t)+ft[ut(2,2)],s=-a/o,ft[ut(1,0)]*=s,ft[ut(1,1)]*=s,ft[ut(1,2)]*=s,n[0]=ft[0],n[1]=ft[1],n[2]=0,n[3]=ft[2],n[4]=ft[3],n[5]=ft[4],n[6]=0,n[7]=ft[5],n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=ft[6],n[13]=ft[7],n[14]=0,n[15]=ft[8]}(Ze,Qe,Ye,Xe,n.projectionMatrix),n.projectionMatrix[10]=2/(r-i),n.projectionMatrix[14]=-(r+i)/(r-i)}(r,i,c,h,n.camera),(0,f.lw)(n.lightMat,n.camera.projectionMatrix,n.camera.viewMatrix);const d=this._textureHeight;n.camera.viewport=[e*d,0,d,d]}_setupMatrices(e,t){(0,f.lw)(this._projectionView,e.projectionMatrix,e.viewMatrix),(0,f.B8)(this._projectionViewInverse,this._projectionView);const r=this._viewingMode===Le.RT.Global?e.eye:(0,_.i)(Ke,0,0,1);(0,f.t5)(this._modelViewLight,[0,0,0],[-t[0],-t[1],-t[2]],r)}_computeCascadeDistances(e,t,r){const i=r?this.settings.maxNumCascadesHighQuality:this.settings.maxNumCascadesLowQuality;this._numCascades=Math.min(1+Math.floor((0,_e.kL)(t/e,4)),i);const n=(t-e)/this._numCascades,o=(t/e)**(1/this._numCascades);let a=e,s=e;for(let l=0;l<this._numCascades+1;++l)this._cascadeDistances[l]=(0,Fe.Cc)(a,s,this.settings.splitSchemeLambda),a*=o,s+=n}get test(){}}const qe=(0,Te.vt)(),Be=(0,F.vt)(),ke=[];for(let At=0;At<8;++At)ke.push((0,F.vt)());const Ze=(0,Se.vt)(),Qe=(0,Se.vt)(),$e=(0,Se.vt)(),Ye=(0,Se.vt)(),Xe=(0,Se.vt)(),Ke=(0,m.vt)(),Je=[],et=(0,Te.vt)(),tt=Te.zK.concat(Te.zK,Te.zK,Te.zK,Te.zK),rt=(0,Se.vt)(),it=(0,Se.vt)(),nt=[(0,Se.vt)(),(0,Se.vt)(),(0,Se.vt)(),(0,Se.vt)()],ot=(0,Se.vt)(),at=(0,Se.vt)(),st=(0,Se.vt)(),lt=(0,Se.vt)(),ct=(0,Se.vt)(),ht=(0,Se.vt)(),dt=(0,Se.vt)();function ut(e,t){return 3*t+e}const gt=(0,Se.vt)();function pt(e,t){return(0,V.hZ)(gt,e[t],e[t+3]),gt}const vt=(0,Se.vt)(),ft=(0,Ne.vt)();class _t extends G.w{constructor(e,t){super(e,t,new U.$(L.a,(()=>r.e(2553).then(r.bind(r,62553)))))}initializePipeline(e){return e.hasAlpha?(0,B.Ey)({blending:B.Ky,colorWrite:B.kn}):(0,B.Ey)({colorWrite:B.kn})}}var mt=r(6485);class xt extends mt.K{constructor(){super(...arguments),this.hasAlpha=!1}}(0,o._)([(0,mt.W)()],xt.prototype,"hasAlpha",void 0);var yt=r(44513),wt=r(71011),Ct=r(80381);class bt extends G.w{constructor(e,t){super(e,t,new U.$(Ct.a,(()=>r.e(1747).then(r.bind(r,71747)))))}}var Tt=r(59752);let St=class extends z.RW{constructor(e){super(e),this._overlays=null,this._renderTargets=null,this._overlayParameters=new Ct.O,this.hasHighlights=!1,this._hasWater=!1,this._renderers=new Map,this._sortedDrapeSourceRenderersDirty=!1,this._sortedRenderers=new h.A,this._passParameters=new L.T,this._materials=null,this._screenToWorldRatio=1,this._localOriginFactory=null,this.unloadedMemory=0,this.ignoresMemoryFactor=!1,this._camera=new E.A,this.events=new a.A,this.longitudeCyclical=null,this.produces=new Map([[De.N.DRAPED_MATERIAL,e=>e!==D.V.Highlight||this.hasHighlights],[De.N.DRAPED_WATER,()=>this._hasWater]]),this._hasTargetWithoutRasterImage=!1,this._hasDrapedFeatureSource=!1,this._hasDrapedRasterSource=!1}initialize(){const e=this._view,t=e._stage,r=t.renderer.fboCache,{waterTextures:i,textures:n}=t.renderView;this._renderContext=new Me(this._rctx,new Ge(r,e.state.viewingMode)),this.addHandles([(0,d.wB)((()=>i.updating),(()=>this.events.emit("content-changed")),d.pc),(0,d.wB)((()=>this.spatialReference),(e=>this._localOriginFactory=new we.g(e)),d.pc),(0,d.on)((()=>e.allLayerViews),"after-changes",(()=>this._sortedDrapeSourceRenderersDirty=!0)),(0,d.wB)((()=>function(e){let t=0;for(const i of e){const{name:e}=i;t+=e.length;const{color:r,fillOpacity:n,haloColor:o,haloOpacity:a}=i;t+=r.r+r.g+r.b+r.a+n,t+=o?o.r+o.g+o.b+o.a+a:0}const r=e.at(0);if(r){const{shadowOpacity:e,shadowDifference:i,shadowColor:n}=r;t+=e+i+n.r+n.g+n.b+n.a}return pe+++(t>=0?0:1)}(e.state.highlights)),(()=>this._sortedDrapeSourceRenderersDirty=!0),d.Vh),(0,d.wB)((()=>e.state.highlights),(t=>{this._bindParameters.highlights=t,this._bindParameters.highlightOrderMap=e.state.highlightOrderMap,this._updateHighlights()}),d.Vh),e.resourceController.scheduler.registerTask(Tt.W6.STAGE,this)]),this._materials=new me(n,this._techniques,(()=>{this.notifyChange("rendersOccludedDraped"),this.events.emit("content-changed"),this.notifyChange("updating"),this.notifyChange("isEmpty")}),(()=>this.events.emit("content-changed")));const{_bindParameters:o,_camera:a}=this;a.near=1,a.far=1e4,a.relativeElevation=null,o.slot=De.N.DRAPED_MATERIAL,o.mainDepth=null,o.camera=a,o.oitPass=be.Y.NONE,o.updateLighting([new wt.$p((0,m.S)())],0,0,ye.Immediate)}destroy(){this._renderers.forEach((e=>e.destroy())),this._renderers.clear(),this._passParameters.texture=(0,c.WD)(this._passParameters.texture),this.disposeOverlays()}get _bindParameters(){return this._renderContext.bind}get _rctx(){return this._stage.renderView.renderingContext}get _view(){return this.parent.view}get _stage(){return this.parent.view._stage}get spatialReference(){return this.parent.spatialReference}get _techniques(){return this._stage.renderView.techniques}get rctx(){return this._rctx}get materials(){return this._materials}get screenToWorldRatio(){return this._screenToWorldRatio}get localOriginFactory(){return this._localOriginFactory}get pluginContext(){return this._pluginContext}initializeRenderContext(e){this._pluginContext=e,this._techniques.precompile(bt)}uninitializeRenderContext(){}acquireTechniques(){return[]}render(){}get updating(){return this._sortedDrapeSourceRenderersDirty||(0,l.Bs)(this._renderers,(e=>e.updating))}get hasOverlays(){return null!=this._overlays&&null!=this._renderTargets}getMaterialRenderer(e){for(const t of this._renderers.values()){const r=t.getMaterialRenderer(e);if(r)return r}return null}get layers(){return this._sortedDrapeSourceRenderersDirty&&this._updateSortedDrapeSourceRenderers(),this._sortedRenderers.map((e=>e.drapeSource.layer)).filter((e=>!!e))}_updateHighlights(){const e=this._view.state;this._renderers.forEach((t=>t.updateHighlights(e.highlightOrderMap)))}createDrapeSourceRenderer(e,t,r){const i=this._renderers.get(e);null!=i&&i.destroy();const o=new t((0,n.A)((0,n.A)({},r),{},{rendererContext:this,drapeSource:e}));return this._renderers.set(e,o),this._sortedDrapeSourceRenderersDirty=!0,"fullOpacity"in e&&this.addHandles((0,d.wB)((()=>e.fullOpacity),(()=>this.events.emit("content-changed"))),e),o}removeDrapeSourceRenderer(e){if(null==e)return;const t=this._renderers.get(e);null!=t&&(this._sortedDrapeSourceRenderersDirty=!0,this._renderers.delete(e),this.removeHandles(e),t.destroy())}computeValidity(){var e,t;return null!==(e=null===(t=this._renderTargets)||void 0===t?void 0:t.computeValidity())&&void 0!==e?e:0}releaseRenderTargets(){var e;null===(e=this._renderTargets)||void 0===e||e.dispose()}get overlays(){var e;return null!==(e=this._overlays)&&void 0!==e?e:[]}ensureDrapeTargets(e){this._hasTargetWithoutRasterImage=!!this._overlays&&(0,u.bw)(e,(e=>e.drapeTargetType===x.sv.WithoutRasterImage))}ensureDrapeSources(e){this._overlays?(this._hasDrapedFeatureSource=(0,u.bw)(e,(e=>e.drapeSourceType===x.Om.Features)),this._hasDrapedRasterSource=(0,u.bw)(e,(e=>e.drapeSourceType===x.Om.RasterImage))):this._hasDrapedFeatureSource=this._hasDrapedRasterSource=!1}get _needsColorWithoutRasterImage(){return this._hasDrapedRasterSource&&this._hasDrapedFeatureSource&&this._hasTargetWithoutRasterImage}ensureOverlays(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this._bindParameters.overlayStretch;null==this._overlays&&(this._renderTargets=new A(this._stage.renderer.fboCache),this._overlays=[new T,new T]),this.ensureDrapeTargets(e),this.ensureDrapeSources(t),this._bindParameters.overlayStretch=r}disposeOverlays(){this._overlays=null,this._renderTargets=(0,c.WD)(this._renderTargets),this.events.emit("textures-disposed")}getTexture(e){var t,r;if(null!=e)return e===i.ColorNoRasterImage&&!this._needsColorWithoutRasterImage&&this._hasDrapedFeatureSource?null===(t=this._renderTargets)||void 0===t?void 0:t.getTexture(i.Color):null===(r=this._renderTargets)||void 0===r?void 0:r.getTexture(e)}get running(){return this.updating}runTask(e){this._processDrapeSources(e,(()=>!0))}_processDrapeSources(e,t){let r=!1;for(const[i,n]of this._renderers){if(e.done)break;(i.destroyed||t(i))&&n.commitChanges(this._view.state.highlightOrderMap)&&(r=!0,e.madeProgress())}this._sortedDrapeSourceRenderersDirty&&(this._sortedDrapeSourceRenderersDirty=!1,r=!0,this._updateSortedDrapeSourceRenderers()),r&&(null!=this._overlays&&0===this._renderers.size&&this.disposeOverlays(),this.notifyChange("updating"),this.notifyChange("isEmpty"),this.events.emit("content-changed"),this.hasHighlights=(0,l.Bs)(this._renderers,(e=>e.hasHighlights)),this.notifyChange("rendersOccludedDraped"))}hasHighlightOptions(e){return(0,l.Bs)(this._renderers,(t=>t.hasHighlightOptions(e)))}processSyncDrapeSources(){this._processDrapeSources(Tt.Bb,(e=>e.updatePolicy===yt.q.SYNC))}get isEmpty(){return!y.b.OVERLAY_DRAW_DEBUG_TEXTURE&&!(0,l.Bs)(this._renderers,(e=>!e.isEmpty))}get hasWater(){const e=(0,l.Bs)(this._renderers,(e=>e.hasWater));return e!==this._hasWater&&(this._hasWater=e,this.events.emit("has-water")),this._hasWater}get rendersOccludedDraped(){const e=this._renderContext.renderOccludedMask;this._renderContext.renderOccludedMask=Pt,++this._techniques.precompiling;const t=this._sortedRenderers.some((e=>{let{renderer:t}=e;return t.precompile(this._renderContext)}));return--this._techniques.precompiling,this._renderContext.renderOccludedMask=e,t}renders(e){if(y.b.OVERLAY_DRAW_DEBUG_TEXTURE&&e!==i.Occluded&&e!==i.Highlight)return!0;++this._techniques.precompiling;const t=this._sortedRenderers.some((e=>{let{renderer:t}=e;return t.precompile(this._renderContext)}));return--this._techniques.precompiling,t}get mode(){var e;return this.isEmpty?N.Disabled:this.hasWater&&this.renders(i.WaterNormal)?N.EnabledWithWater:null!==(e=this._renderTargets)&&void 0!==e&&e.getTexture(i.Color)?N.Enabled:N.Disabled}updateAnimation(e){let t=!1;return this._renderers.forEach((r=>t=r.updateAnimation(e)||t)),t&&this.parent.requestRender(ne.C7.BACKGROUND),t}updateDrapeSourceOrder(){this._sortedDrapeSourceRenderersDirty=!0}precompileShaders(e){if(this._renderTargets){this._bindParameters.alignPixelEnabled=e.alignPixelEnabled,++this._techniques.precompiling;for(const e of this._renderTargets.targets){if(e.content===i.ColorNoRasterImage&&!this._needsColorWithoutRasterImage)continue;const t=e.output;this._renderContext.output=t,this._bindParameters.slot=t===D.V.Normal?De.N.DRAPED_WATER:De.N.DRAPED_MATERIAL,e.content===i.Occluded&&(this._renderContext.renderOccludedMask=Pt),this._sortedRenderers.forAll((t=>{let{drapeSource:r,renderer:n}=t;e.content===i.ColorNoRasterImage&&r.drapeSourceType===x.Om.RasterImage||n.precompile(this._renderContext)})),this._renderContext.renderOccludedMask=Ee}--this._techniques.precompiling}}drawOverlays(e){if(this._overlays&&this._renderTargets){for(const e of this._overlays)this.longitudeCyclical?e.setupGeometryViewsCyclical(this.longitudeCyclical):e.setupGeometryView();this._bindParameters.alignPixelEnabled=e.alignPixelEnabled;for(const e of this._renderTargets.targets){if(e.content===i.ColorNoRasterImage&&!this._needsColorWithoutRasterImage)continue;const t=this._drawTarget(w.vr.INNER,e),r=this._drawTarget(w.vr.OUTER,e);(t||r)&&e.fbo.generateMipMap()}}}_drawTarget(e,t){const r=this._overlays[e],n=r.canvasGeometries;if(0===n.numViews)return!1;const o=this._view.state.contentPixelRatio;this._screenToWorldRatio=o*r.mapUnitsPerPixel/this._bindParameters.overlayStretch;const a=t.output;if(this.isEmpty||a===D.V.Normal&&!this.hasWater||!r.hasSomeSizedView())return!1;const{_rctx:s,_camera:l,_renderContext:c,_bindParameters:h}=this;if(l.pixelRatio=r.pixelRatio*o,c.output=a,h.screenToWorldRatio=this._screenToWorldRatio,h.screenToPCSRatio=this._screenToWorldRatio*this.parent.worldToPCSRatio,h.slot=a===D.V.Normal?De.N.DRAPED_WATER:De.N.DRAPED_MATERIAL,t.content===i.Occluded&&(c.renderOccludedMask=Pt),!this.renders(t.content))return c.renderOccludedMask=Ee,!1;const{resolution:d}=r,u=e===w.vr.INNER?0:d;if(s.setViewport(u,0,d,d),this._bindTargetFBO(t),e===w.vr.INNER&&(s.setClearColor(0,0,0,0),s.clear(ce.NV.COLOR)),y.b.OVERLAY_DRAW_DEBUG_TEXTURE&&t.content!==i.Occluded&&t.content!==i.Highlight){this._techniques.precompile(_t,It);const t=this._techniques.get(_t,It);for(let i=0;i<n.numViews;i++)this._setViewParameters(n.extents[i],r),this._ensureDebugPatternResources(r.resolution,Rt[e]),s.bindTechnique(t,h,this._passParameters),s.screen.draw()}if(t.output===D.V.Highlight){const{fboCache:r}=this._stage.renderer,i=this._resolution;this._bindTargetFBO(t),function(e,t,r,i,n){let o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;const a=i.highlights,s=a.length>1?t.acquire(r.width,r.height,"highlight mix",R.N.RG):null;if(s){const t=e.getBoundFramebufferObject();e.bindFramebuffer(s.fbo),e.clearFramebuffer(F.uY),e.bindFramebuffer(t)}const l=null===s||void 0===s?void 0:s.getTexture();i.highlightMixTexture=l,(0,V.hZ)(i.highlightMixOrigin,o,0),a.forEach(((t,a)=>{a>0&&(e.bindTexture(l,he.g.TEXTURE_UNIT_FOR_UPDATES),e.gl.copyTexSubImage2D(ce.Ap.TEXTURE_2D,0,0,0,o,0,r.width,r.height),e.bindTexture(null,he.g.TEXTURE_UNIT_FOR_UPDATES)),e.clear(ce.NV.DEPTH),i.highlightLevel=a,n()})),i.highlightLevel=null,i.highlightMixTexture=null,null===s||void 0===s||s.release()}(s,r,{width:i,height:i},h,(()=>this._renderAllGeometry(e,t)),u)}else this._renderAllGeometry(e,t);return s.bindFramebuffer(null),c.renderOccludedMask=Ee,!0}_renderAllGeometry(e,t){const r=this._overlays[e],n=r.canvasGeometries;this._sortedRenderers.forAll((o=>{let{drapeSource:a,renderer:s}=o;if(t.content===i.ColorNoRasterImage&&a.drapeSourceType===x.Om.RasterImage)return;const{fullOpacity:l}=a,c=null!=l&&l<1&&t.output===D.V.Color&&this._bindTemporaryFBO();for(let e=0;e<n.numViews;e++)this._setViewParameters(n.extents[e],r),s.render(this._renderContext);if(c){this._bindTargetFBO(t),this._overlayParameters.texture=c.getTexture(),this._overlayParameters.opacity=l,this._overlayParameters.overlayIndex=e;const r=this._techniques.get(bt);this._rctx.bindTechnique(r,this._bindParameters,this._overlayParameters),this._rctx.screen.draw(),c.release()}}))}_bindTargetFBO(e){const t=this._resolution,r=2*t;e.fbo.bind(this._rctx,r,t)}_bindTemporaryFBO(){const e=this._resolution,t=2*e,r=this._stage.renderer.fboCache,i=r.acquire(t,e,"overlay tmp");return r.rctx.bindFramebuffer(i.fbo),r.rctx.clear(ce.NV.COLOR),i}get _resolution(){var e,t;return null!==(e=null===(t=this._overlays)||void 0===t?void 0:t[w.vr.INNER].resolution)&&void 0!==e?e:0}notifyContentChanged(){this.events.emit("content-changed")}intersect(e,t,r,i){this._sortedDrapeSourceRenderersDirty&&this._updateSortedDrapeSourceRenderers();let n=0;for(const{renderer:s}of this._sortedRenderers){var o,a;n=null!==(o=null===(a=s.intersect)||void 0===a?void 0:a.call(s,e,t,r,i,n))&&void 0!==o?o:n}}_updateSortedDrapeSourceRenderers(){if(this._sortedRenderers.clear(),0===this._renderers.size)return;const e=this._view.map.allLayers,t=e.length;this._renderers.forEach(((r,i)=>{var n;const o=e.indexOf(i.layer),a=o>=0,s=null!==(n=i.renderGroup)&&void 0!==n?n:a?x.O7.MapLayer:x.O7.ViewLayer,l=t*s+(a?o:0);this._sortedRenderers.push(new Ot(i,r,l))})),this._sortedRenderers.sort(((e,t)=>e.index-t.index))}_setViewParameters(e,t){const r=this._camera;r.viewport=[0,0,t.resolution,t.resolution],(0,f.v3)(r.projectionMatrix,0,e[2]-e[0],0,e[3]-e[1],r.near,r.far),(0,f.kN)(r.viewMatrix,[-e[0],-e[1],0])}_ensureDebugPatternResources(e,t){if((0,_.i)(this._passParameters.color,t[0],t[1],t[2]),this._passParameters.texture)return;const r=new Uint8Array(e*e*4);let i=0;for(let o=0;o<e;o++)for(let t=0;t<e;t++){const n=Math.floor(t/10),a=Math.floor(o/10);n<2||a<2||10*n>e-20||10*a>e-20?(r[i++]=255,r[i++]=255,r[i++]=255,r[i++]=255):(r[i++]=255,r[i++]=255,r[i++]=255,r[i++]=1&n&&1&a?1&t^1&o?0:255:1&n^1&a?0:128)}const n=new de.R(e);n.samplingMode=ce.Cj.NEAREST,this._passParameters.texture=new he.g(this._rctx,n,r)}get test(){}};(0,o._)([(0,g.MZ)()],St.prototype,"hasHighlights",void 0),(0,o._)([(0,g.MZ)()],St.prototype,"_sortedDrapeSourceRenderersDirty",void 0),(0,o._)([(0,g.MZ)({constructOnly:!0})],St.prototype,"parent",void 0),(0,o._)([(0,g.MZ)({readOnly:!0})],St.prototype,"_techniques",null),(0,o._)([(0,g.MZ)({type:Boolean,readOnly:!0})],St.prototype,"updating",null),(0,o._)([(0,g.MZ)()],St.prototype,"isEmpty",null),(0,o._)([(0,g.MZ)({readOnly:!0})],St.prototype,"rendersOccludedDraped",null),St=(0,o._)([(0,v.$)("esri.views.3d.terrain.OverlayRenderer")],St);class Ot{constructor(e,t,r){this.drapeSource=e,this.renderer=t,this.index=r}}const Rt=[[1,.5,.5],[.5,.5,1]],Dt=-2,Pt=Ce.m$.OccludeAndTransparent,It=new xt;It.hasAlpha=!0},70667:(e,t,r)=>{r.d(t,{t:()=>f,z:()=>x});var i=r(19555),n=r(72745),o=r(55855),a=r(34111),s=r(482),l=r(44815),c=r(75002),h=r(38496),d=r(64465),u=r(50468),g=r(87634),p=r(17345),v=r(66470);function f(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const n=[],f=t.mapPositions;!function(e,t){const{attributeData:{position:r},removeDuplicateStartEnd:i}=e,n=function(e){const t=e.length;return e[0]===e[t-3]&&e[1]===e[t-2]&&e[2]===e[t-1]}(r)&&i,o=r.length/3-(n?1:0),a=new Array(2*(o-1)),s=n?r.slice(0,-3):r;let l=0;for(let c=0;c<o-1;c++)a[l++]=c,a[l++]=c+1;t.push([v.r.POSITION,new u.n(s,a,3,n)])}(t,n);const x=n[0][1].data,y=n[0][1].indices.length,w=(0,h.EH)(y);return function(e,t,r){if(null!=e.attributeData.colorFeature)return;const i=e.attributeData.color;t.push([v.r.COLOR,new u.n(null!==i&&void 0!==i?i:o.Un,r,4)])}(t,n,w),function(e,t,r){var i;null==e.attributeData.sizeFeature&&t.push([v.r.SIZE,new u.n([null!==(i=e.attributeData.size)&&void 0!==i?i:1],r,1,!0)])}(t,n,w),function(e,t,r){e.attributeData.normal&&t.push([v.r.NORMAL,new u.n(e.attributeData.normal,r,3)])}(t,n,w),function(e,t,r){null!=e.attributeData.colorFeature&&t.push([v.r.COLORFEATUREATTRIBUTE,new u.n([e.attributeData.colorFeature],r,1,!0)])}(t,n,w),function(e,t,r){null!=e.attributeData.sizeFeature&&t.push([v.r.SIZEFEATUREATTRIBUTE,new u.n([e.attributeData.sizeFeature],r,1,!0)])}(t,n,w),function(e,t,r){null!=e.attributeData.opacityFeature&&t.push([v.r.OPACITYFEATUREATTRIBUTE,new u.n([e.attributeData.opacityFeature],r,1,!0)])}(t,n,w),function(e,t,r){if(null==e.overlayInfo||e.overlayInfo.renderCoordsHelper.viewingMode!==d.RT.Global||!e.overlayInfo.spatialReference.isGeographic)return;const n=(0,l.jh)(r.length),o=(0,a.tO)(e.overlayInfo.spatialReference);for(let i=0;i<n.length;i+=3)(0,s.RC)(r,i,n,i,o);const h=r.length/3,g=(0,c.oe)(h+1);let p=_,f=m,x=0,y=0;(0,i.hZ)(p,n[y++],n[y++]),y++,g[0]=0;for(let a=1;a<h+1;++a)a===h&&(y=0),(0,i.hZ)(f,n[y++],n[y++]),y++,x+=(0,i.xg)(p,f),g[a]=x,[p,f]=[f,p];t.push([v.r.DISTANCETOSTART,new u.n(g,t[0][1].indices,1,!0)])}(t,n,x),new p.V(e,n,f,g.X.Line,r)}const _=(0,n.vt)(),m=(0,n.vt)();function x(e,t){if(null==e||0===e.length)return[];const r=[];return e.forEach((e=>{const i=e.length,n=(0,l.jh)(3*i);e.forEach(((e,t)=>{n[3*t]=e[0],n[3*t+1]=e[1],n[3*t+2]=e[2]}));const o={attributeData:{position:n,normal:t},removeDuplicateStartEnd:!1};r.push(o)})),r}},75941:(e,t,r)=>{r.d(t,{O:()=>i});class i{constructor(){this._outer=new Map}clear(){this._outer.clear()}get empty(){return 0===this._outer.size}get(e,t){var r;return null===(r=this._outer.get(e))||void 0===r?void 0:r.get(t)}getInner(e){return this._outer.get(e)}set(e,t,r){const i=this._outer.get(e);i?i.set(t,r):this._outer.set(e,new Map([[t,r]]))}delete(e,t){const r=this._outer.get(e);r&&(r.delete(t),0===r.size&&this._outer.delete(e))}forEach(e){this._outer.forEach(((t,r)=>e(t,r)))}forAll(e){for(const t of this._outer.values())for(const r of t.values())e(r)}}},76956:(e,t,r)=>{r.d(t,{v:()=>A});var i=r(55855),n=r(48549),o=r(34981),a=r(61785),s=r(83490),l=r(59696),c=r(60322),h=r(77730),d=r(66470),u=r(82809),g=r(63928),p=r(93684),v=r(16506),f=r(59246),_=r(72001),m=r(96643),x=r(37923),y=r(93345),w=r(57162);p.S;class C extends f.w{constructor(e,t){super(e,t,new v.$(x.C,(()=>r.e(5837).then(r.bind(r,35837)))))}_createPipeline(e,t){const{oitPass:r,output:i,transparent:n,cullFace:a,draped:s,hasOccludees:l,polygonOffset:h,enableOffset:d}=e,u=r===_.Y.NONE,g=r===_.Y.FrontFace;return(0,w.Ey)({blending:(0,o.RN)(i)&&n?(0,c.Yf)(r):null,culling:(0,w.Xt)(a),depthTest:s?null:{func:(0,c.K_)(r)},depthWrite:(0,c.z5)(e),drawBuffers:i===o.V.Depth?{buffers:[y.Hr.NONE]}:(0,c.m6)(r,i),colorWrite:w.kn,stencilWrite:l?m.v0:null,stencilTest:l?t?m.a9:m.qh:null,polygonOffset:u||g?h?b:null:(0,c.aB)(d)})}initializePipeline(e){return this._occludeePipelineState=this._createPipeline(e,!0),this._createPipeline(e,!1)}getPipeline(e){return e?this._occludeePipelineState:super.getPipeline()}}const b={factor:1,units:1};var T=r(35143),S=r(97808),O=r(42717),R=r(6485),D=r(94570);class P extends D.E{constructor(){super(...arguments),this.cullFace=s.s2.None,this.hasVertexColors=!1,this.transparent=!1,this.discardInvisibleFragments=!1,this.polygonOffset=!1,this.enableOffset=!0,this.writeDepth=!0,this.hasOccludees=!1,this.terrainDepthTest=!1,this.cullAboveTerrain=!1,this.objectAndLayerIdColorInstanced=!1,this.vvColor=!1,this.draped=!1,this.textureCoordinateType=S.I.None,this.emissionSource=O.ZX.None,this.occlusionPass=!1,this.hasVvInstancing=!0,this.vvSize=!1,this.vvOpacity=!1}}(0,T._)([(0,R.W)({count:s.s2.COUNT})],P.prototype,"cullFace",void 0),(0,T._)([(0,R.W)()],P.prototype,"hasVertexColors",void 0),(0,T._)([(0,R.W)()],P.prototype,"transparent",void 0),(0,T._)([(0,R.W)()],P.prototype,"discardInvisibleFragments",void 0),(0,T._)([(0,R.W)()],P.prototype,"polygonOffset",void 0),(0,T._)([(0,R.W)()],P.prototype,"enableOffset",void 0),(0,T._)([(0,R.W)()],P.prototype,"writeDepth",void 0),(0,T._)([(0,R.W)()],P.prototype,"hasOccludees",void 0),(0,T._)([(0,R.W)()],P.prototype,"terrainDepthTest",void 0),(0,T._)([(0,R.W)()],P.prototype,"cullAboveTerrain",void 0),(0,T._)([(0,R.W)()],P.prototype,"objectAndLayerIdColorInstanced",void 0),(0,T._)([(0,R.W)()],P.prototype,"vvColor",void 0),(0,T._)([(0,R.W)()],P.prototype,"draped",void 0);var I=r(75569);class A extends g.W{constructor(e){super(e,E),this._configuration=new P,this.supportsEdges=!0,this.produces=new Map([[h.N.OPAQUE_MATERIAL,e=>this._isOpaqueMaterialPass(e)],[h.N.OPAQUE_MATERIAL_WITHOUT_NORMALS,e=>this._isOpaqueNoSSAODepthPass(e)],[h.N.TRANSPARENT_MATERIAL,e=>(0,o.QG)(e)&&this._transparent&&this.parameters.writeDepth],[h.N.TRANSPARENT_MATERIAL_WITHOUT_NORMALS,e=>(0,o.eh)(e)&&this._transparent&&this.parameters.writeDepth],[h.N.TRANSPARENT_MATERIAL_WITHOUT_DEPTH,e=>(0,o.QG)(e)&&this._transparent&&!this.parameters.writeDepth],[h.N.DRAPED_MATERIAL,e=>(0,o.i3)(e)]])}getConfiguration(e,t){return this._configuration.output=e,this._configuration.cullFace=this.parameters.cullFace,this._configuration.hasVertexColors=this.parameters.hasVertexColors&&!this.parameters.vvColor,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.transparent=this._transparent,this._configuration.discardInvisibleFragments=this._transparent&&!this._isOpaquePass(e)&&this.parameters.discardInvisibleFragments,this._configuration.polygonOffset=this.parameters.polygonOffset,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.hasOccludees=t.hasOccludees,this._configuration.oitPass=t.oitPass,this._configuration.enableOffset=t.camera.relativeElevation<c.xt,this._configuration.terrainDepthTest=t.terrainDepthTest&&(0,o.RN)(e),this._configuration.cullAboveTerrain=t.cullAboveTerrain,this._configuration.vvColor=!!this.parameters.vvColor,this._configuration.draped=this.parameters.draped,this._configuration}get visible(){return this.parameters.color[3]>=I.Q}get _transparent(){return this.parameters.color[3]<1||this.parameters.forceTransparentMode}_isOpaquePass(e){return this._isOpaqueMaterialPass(e)||this._isOpaqueNoSSAODepthPass(e)}_isOpaqueMaterialPass(e){return e===o.V.Highlight||(0,o.QG)(e)&&!this._transparent}_isOpaqueNoSSAODepthPass(e){return(0,o.eh)(e)&&this.parameters.writeDepth&&!this._transparent}createGLMaterial(e){return new M(e)}createBufferWriter(){const e=(0,n.BP)().vec3f(d.r.POSITION);return(0,a.E)()&&e.vec4u8(d.r.OBJECTANDLAYERIDCOLOR),this.parameters.vvColor?e.f32(d.r.COLORFEATUREATTRIBUTE):e.vec4u8(d.r.COLOR),new u.Z(e)}}class M extends l.A{beginSlot(e){return this.getTechnique(C,e)}}class E extends p.S{constructor(){super(...arguments),this.color=i.uY,this.forceTransparentMode=!1,this.writeDepth=!0,this.hasVertexColors=!1,this.polygonOffset=!1,this.hasSlicePlane=!1,this.cullFace=s.s2.None,this.draped=!1,this.discardInvisibleFragments=!1}}},80381:(e,t,r)=>{r.d(t,{O:()=>g,a:()=>v,b:()=>p});var i,n=r(57528),o=r(19539),a=r(73398),s=r(21390),l=r(86955),c=r(72790),h=r(70367),d=r(31432),u=r(2687);class g extends d.Y{constructor(){super(...arguments),this.overlayIndex=o.vr.INNER,this.opacity=1}}function p(){const e=new u.N5;return e.include(a.c),e.fragment.uniforms.add(new h.N("tex",(e=>e.texture))),e.fragment.uniforms.add(new c.c("overlayIdx",(e=>e.overlayIndex))),e.fragment.uniforms.add(new s.m("opacity",(e=>e.opacity))),e.fragment.main.add((0,l.H)(i||(i=(0,n.A)(["vec2 overlayUV = overlayIdx == 0 ? vec2(uv.x * 0.5, uv.y) : vec2(uv.x * 0.5 + 0.5, uv.y);\nfragColor = texture(tex, overlayUV) * opacity;"])))),e}const v=Object.freeze(Object.defineProperty({__proto__:null,OverlayCompositingPassParameters:g,build:p},Symbol.toStringTag,{value:"Module"}))},82062:(e,t,r)=>{var i;r.d(t,{$:()=>i}),function(e){e[e.EnableFastUpdates=0]="EnableFastUpdates",e[e.DisableFastUpdates=1]="DisableFastUpdates",e[e.UpdateFastLocalOrigin=2]="UpdateFastLocalOrigin"}(i||(i={}))},86401:(e,t,r)=>{r.d(t,{Ci:()=>o,Dq:()=>l,dB:()=>s,zK:()=>a});var i=r(48549),n=r(66470);const o=(0,i.BP)().vec3f(n.r.POSITION),a=(0,i.BP)().vec3f(n.r.POSITION).vec2f(n.r.UV0),s=(0,i.BP)().vec3f(n.r.POSITION).vec4u8(n.r.COLOR),l=(0,i.BP)().vec3f(n.r.POSITION).vec2f(n.r.UV0).vec4u8(n.r.OBJECTANDLAYERIDCOLOR)}}]);
//# sourceMappingURL=1561.e31d5bc7.chunk.js.map