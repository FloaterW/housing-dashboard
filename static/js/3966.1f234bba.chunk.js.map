{"version":3,"file":"static/js/3966.1f234bba.chunk.js","mappings":"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","sources":["../node_modules/@arcgis/core/layers/support/TitleCreator.js","../node_modules/@arcgis/core/webdoc/interfaces.js","../node_modules/@arcgis/core/layers/support/displayFilterUtils.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.32/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../chunks/tslib.es6.js\";import t from\"../../core/Accessor.js\";import{createTask as s}from\"../../core/asyncUtils.js\";import i from\"../../core/Collection.js\";import{property as r}from\"../../core/accessorSupport/decorators/property.js\";import\"../../core/has.js\";import\"../../core/Logger.js\";import\"../../core/RandomLCG.js\";import{subclass as a}from\"../../core/accessorSupport/decorators/subclass.js\";import{featureHasFields as o,extractSubstitutionTemplatesFromString as n}from\"./fieldUtils.js\";import{loadArcade as l}from\"../../support/arcadeOnDemand.js\";const p=\"relationships/\",c=\"expression/\";let d=class extends t{constructor(e){super(e),this._featureUtils=null,this.effectivePopupTemplate=null}get _arcadeTask(){if(this.expressionsUsedInTitle.length>0){return this._get(\"_arcadeTask\")||s((()=>l()))}return null}get featureUtilsPromise(){return this._get(\"featureUtilsPromise\")??import(\"../../widgets/Feature/support/featureUtils.js\").then((e=>this._featureUtils=e))}get calculatedExpressions(){const e=new i;if(!this.expressionsUsedInTitle.length)return e;if(!this._arcadeTask?.value){for(const t of this.expressionsUsedInTitle??[])e.push({name:t.name,invalid:!0});return e}for(const t of this.expressionsUsedInTitle)try{const s=this._arcadeTask.value.arcade.parseScript(t.expression,[\"$layer\",\"$map\",\"$datastore\"]);if(s.isAsync){e.push({name:t.name,invalid:!0});break}e.push({name:t.name,syntax:s,invalid:!1,func:this._arcadeTask.value.arcade.compileScript(s,{vars:{$feature:\"any\"}})})}catch{e.push({name:t.name,invalid:!0});break}return e}get expressionsUsedInTitle(){let e=this.effectivePopupTemplate?.title??\"\";return\"string\"!=typeof e?[]:(e=e.toLowerCase(),this.effectivePopupTemplate?.expressionInfos?.filter((t=>e.includes(`{expression/${t.name.toLowerCase()}}`)))??[])}get fieldInfoMap(){return this._featureUtils?this._createFieldInfoMap(this._featureUtils.getAllFieldInfos(this.effectivePopupTemplate)):null}get hasBadExpressions(){return this.calculatedExpressions.some((e=>!0===e.invalid))}get requiredFields(){const e=new Set;if(this._arcadeTask?.value&&!this.hasBadExpressions)for(const s of this.calculatedExpressions?.toArray()??[])try{const t=this._arcadeTask.value.arcade.extractFieldLiterals(s.syntax);for(const s of t){const t=s.split(\".\"),i=this.fieldsIndex.get(t.at(-1)??\"\");i&&e.add(i.name)}}catch{}const t=this._extractFieldNames(this.workingTitle);for(const s of t){const t=this.fieldsIndex.get(s);t&&e.add(t.name)}return e}get titleFromDisplayField(){let e=\"\";return this.displayField&&(e=this.fieldsIndex.get(this.displayField)?.name??\"\"),e||(e=this.fieldsIndex.get(this.objectIdField)?.name??\"\"),e?`{${e}}`:\"\"}get workingTitle(){const e=this.effectivePopupTemplate?this.effectivePopupTemplate.title:\"\";return\"\"===e||null==e||this.hasBadExpressions||\"string\"!=typeof e?this.titleFromDisplayField:e}async getTitle(e,t,s){try{const{attributes:i}=t,r=s?.timeZone??\"system\",[{substituteFieldsInLinksAndAttributes:a}]=await Promise.all([this.featureUtilsPromise,this._arcadeTask?.promise]);if(s.fetchMissingFields&&(t=await this._checkAndReQueryGraphic(e,t)),this.workingTitle&&this.fieldInfoMap){const s=this._createFormattedAttributes(e,t,r).global;return a({attributes:i,expressionAttributes:null,fieldInfoMap:this.fieldInfoMap,globalAttributes:s,layer:e,text:this.workingTitle})}return\"\"}catch{}return\"\"}async _checkAndReQueryGraphic(e,t){const s=t.getObjectId();if(null==s)return t;if(!o(this.requiredFields,t)){const t=e.createQuery();t.where=\"1=1\",t.outFields=[...this.requiredFields],t.objectIds=[s];const i=await e.queryFeatures(t);if(1===i?.features.length)return i.features[0]}return t}_createFieldInfoMap(e){const t=new Map;if(!e)return t;for(const s of e){if(!s.fieldName)continue;const e=this.fieldsIndex.get(s.fieldName),i=e?.name??s.fieldName;s.fieldName=i,t.set(i.toLowerCase(),s)}return t}_createFormattedAttributes(e,t,s=\"system\"){const i=this.effectivePopupTemplate?.fieldInfos??[],r={};if(!this._featureUtils)return{};if(!this.hasBadExpressions&&this.calculatedExpressions.length>0&&this._arcadeTask?.value){const s=this._arcadeTask.value.Feature.createFromGraphicLikeObject(t.geometry,t.attributes,e,null);for(const e of this.calculatedExpressions)try{r[`expression/${e.name}`]=e.func({vars:{$feature:s}})}catch{}}const a={...t.attributes,...r};return{global:this._featureUtils.formatAttributes({fieldInfos:i,attributes:a,graphic:t,timeZone:s,layer:e,fieldInfoMap:this.fieldInfoMap}),content:[]}}_extractFieldNames(e){return n(e).filter((e=>!(0===e.indexOf(p)||0===e.indexOf(c))))}};e([r({readOnly:!0})],d.prototype,\"_arcadeTask\",null),e([r()],d.prototype,\"_featureUtils\",void 0),e([r({readOnly:!0})],d.prototype,\"featureUtilsPromise\",null),e([r({readOnly:!0})],d.prototype,\"calculatedExpressions\",null),e([r()],d.prototype,\"displayField\",void 0),e([r()],d.prototype,\"effectivePopupTemplate\",void 0),e([r()],d.prototype,\"expressionsUsedInTitle\",null),e([r()],d.prototype,\"fieldsIndex\",void 0),e([r()],d.prototype,\"fieldInfoMap\",null),e([r()],d.prototype,\"fields\",void 0),e([r()],d.prototype,\"objectIdField\",void 0),e([r()],d.prototype,\"requiredFields\",null),d=e([a(\"esri.layers.support.TitleCreator\")],d);const u=d;export{u as default};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.32/esri/copyright.txt for details.\n*/\nvar A;!function(A){A[A.SAVE=0]=\"SAVE\",A[A.SAVE_AS=1]=\"SAVE_AS\"}(A||(A={}));export{A as SaveOperationType};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.32/esri/copyright.txt for details.\n*/\nimport{floatGreaterThan as e,floatLessThan as n,floatEqualAbsolute as t,floatGreaterThanOrEqual as r}from\"../../core/mathUtils.js\";import{sqlOr as o}from\"../../core/sql.js\";function i(e,n){return{...n,filterMode:e.mode}}function u(e,n){return l(e,n).next().value??null}function c(t,r,i){const u=f(t);if(u&&(e(r,u[0])||n(i,u[1])))return\"\";const c=Array.from(l(t,r,i)),m=a(c,r,i)?\"1=1\":c.map((e=>e.where||\"1=1\")).reduce(((e,n)=>o(e,n)),\"\");return m&&\"1=1\"!==m?m:\"\"}function f(e){if(\"manual\"===s(e))return null;const n=[Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY];for(const{minScale:t,maxScale:r}of e.filters)n[0]=Math.max(n[0],I(t)),n[1]=Math.min(n[1],d(r));return n}function*l(e,n,t){if(\"manual\"===s(e)){const n=e.filters.find((n=>n.id===e.activeFilterId));n&&(yield n)}else{\"object\"==typeof n&&(n=n.scale);for(const r of e.filters)m(r.minScale,r.maxScale,n,t)&&(yield r)}}function a(t,r,o){if(0===t.length)return!0;const i=I(t.at(0)?.minScale),u=d(t.at(-1)?.maxScale);if(n(i,r)||e(u,o))return!0;for(let e=0;e<t.length-1;e++){const r=t[e],o=t[e+1];if(n(I(o.minScale),d(r.maxScale)))return!0}return!1}function m(e,n,o,i){return e=I(e),o=I(o),n=d(n),!(!t(o,e)&&(i??o)>e)&&(!r(n,o)&&(void 0===i||!t(i,e)))}function s(e){return\"mode\"in e?e.mode:e.filterMode}function I(e){return e||Number.POSITIVE_INFINITY}function d(e){return e||0}export{i as createDisplayFilterJSONContext,c as getClauseForScaleRange,u as getEffectiveDisplayFilter};\n"],"names":["d","t","constructor","e","super","this","_featureUtils","effectivePopupTemplate","_arcadeTask","expressionsUsedInTitle","length","_get","s","l","featureUtilsPromise","_this$_get","then","calculatedExpressions","_this$_arcadeTask","i","value","_this$expressionsUsed","push","name","invalid","arcade","parseScript","expression","isAsync","syntax","func","compileScript","vars","$feature","_unused","_this$effectivePopupT","_this$effectivePopupT2","_this$effectivePopupT3","_this$effectivePopupT4","title","toLowerCase","expressionInfos","filter","includes","concat","fieldInfoMap","_createFieldInfoMap","getAllFieldInfos","hasBadExpressions","some","requiredFields","_this$_arcadeTask2","Set","_this$calculatedExpre","_this$calculatedExpre2","toArray","extractFieldLiterals","_t$at","split","fieldsIndex","get","at","add","_unused2","_extractFieldNames","workingTitle","titleFromDisplayField","_this$fieldsIndex$get","_this$fieldsIndex$get2","_this$fieldsIndex$get3","_this$fieldsIndex$get4","displayField","objectIdField","getTitle","_s$timeZone","_this$_arcadeTask3","attributes","r","timeZone","substituteFieldsInLinksAndAttributes","a","Promise","all","promise","fetchMissingFields","_checkAndReQueryGraphic","_createFormattedAttributes","global","expressionAttributes","globalAttributes","layer","text","_unused3","getObjectId","o","createQuery","where","outFields","objectIds","queryFeatures","features","Map","_e$name","fieldName","set","_this$effectivePopupT5","_this$effectivePopupT6","_this$_arcadeTask4","arguments","undefined","fieldInfos","Feature","createFromGraphicLikeObject","geometry","_unused4","_objectSpread","formatAttributes","graphic","content","n","indexOf","readOnly","prototype","u","A","SAVE","SAVE_AS","filterMode","mode","_l$next$value","next","c","Number","NEGATIVE_INFINITY","POSITIVE_INFINITY","minScale","maxScale","filters","Math","max","I","min","f","Array","from","m","_t$at2","map","reduce","find","id","activeFilterId","scale"],"sourceRoot":""}