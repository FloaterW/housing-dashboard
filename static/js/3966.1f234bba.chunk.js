"use strict";(self.webpackChunkhousing_dashboard=self.webpackChunkhousing_dashboard||[]).push([[3966],{20665:(e,t,i)=>{i.d(t,{A:()=>p});var s=i(89379),r=i(35143),n=i(91967),l=i(98773),a=i(94643),o=i(46053),d=(i(81806),i(76460),i(47249),i(85842)),u=i(53430),c=i(98976);let f=class extends n.A{constructor(e){super(e),this._featureUtils=null,this.effectivePopupTemplate=null}get _arcadeTask(){return this.expressionsUsedInTitle.length>0?this._get("_arcadeTask")||(0,l.UT)((()=>(0,c.lw)())):null}get featureUtilsPromise(){var e;return null!==(e=this._get("featureUtilsPromise"))&&void 0!==e?e:i.e(9912).then(i.bind(i,9912)).then((e=>this._featureUtils=e))}get calculatedExpressions(){var e;const t=new a.A;if(!this.expressionsUsedInTitle.length)return t;if(null===(e=this._arcadeTask)||void 0===e||!e.value){for(const e of null!==(i=this.expressionsUsedInTitle)&&void 0!==i?i:[]){var i;t.push({name:e.name,invalid:!0})}return t}for(const r of this.expressionsUsedInTitle)try{const e=this._arcadeTask.value.arcade.parseScript(r.expression,["$layer","$map","$datastore"]);if(e.isAsync){t.push({name:r.name,invalid:!0});break}t.push({name:r.name,syntax:e,invalid:!1,func:this._arcadeTask.value.arcade.compileScript(e,{vars:{$feature:"any"}})})}catch(s){t.push({name:r.name,invalid:!0});break}return t}get expressionsUsedInTitle(){var e,t,i,s;let r=null!==(e=null===(t=this.effectivePopupTemplate)||void 0===t?void 0:t.title)&&void 0!==e?e:"";return"string"!=typeof r?[]:(r=r.toLowerCase(),null!==(i=null===(s=this.effectivePopupTemplate)||void 0===s||null===(s=s.expressionInfos)||void 0===s?void 0:s.filter((e=>r.includes("{expression/".concat(e.name.toLowerCase(),"}")))))&&void 0!==i?i:[])}get fieldInfoMap(){return this._featureUtils?this._createFieldInfoMap(this._featureUtils.getAllFieldInfos(this.effectivePopupTemplate)):null}get hasBadExpressions(){return this.calculatedExpressions.some((e=>!0===e.invalid))}get requiredFields(){var e;const t=new Set;if(null!==(e=this._arcadeTask)&&void 0!==e&&e.value&&!this.hasBadExpressions)for(const a of null!==(i=null===(s=this.calculatedExpressions)||void 0===s?void 0:s.toArray())&&void 0!==i?i:[]){var i,s;try{const e=this._arcadeTask.value.arcade.extractFieldLiterals(a.syntax);for(const i of e){var r;const e=i.split("."),s=this.fieldsIndex.get(null!==(r=e.at(-1))&&void 0!==r?r:"");s&&t.add(s.name)}}catch(l){}}const n=this._extractFieldNames(this.workingTitle);for(const a of n){const e=this.fieldsIndex.get(a);e&&t.add(e.name)}return t}get titleFromDisplayField(){var e,t,i,s;let r="";return this.displayField&&(r=null!==(e=null===(t=this.fieldsIndex.get(this.displayField))||void 0===t?void 0:t.name)&&void 0!==e?e:""),r||(r=null!==(i=null===(s=this.fieldsIndex.get(this.objectIdField))||void 0===s?void 0:s.name)&&void 0!==i?i:""),r?"{".concat(r,"}"):""}get workingTitle(){const e=this.effectivePopupTemplate?this.effectivePopupTemplate.title:"";return""===e||null==e||this.hasBadExpressions||"string"!=typeof e?this.titleFromDisplayField:e}async getTitle(e,t,i){try{var s,r;const{attributes:n}=t,l=null!==(s=null===i||void 0===i?void 0:i.timeZone)&&void 0!==s?s:"system",[{substituteFieldsInLinksAndAttributes:a}]=await Promise.all([this.featureUtilsPromise,null===(r=this._arcadeTask)||void 0===r?void 0:r.promise]);if(i.fetchMissingFields&&(t=await this._checkAndReQueryGraphic(e,t)),this.workingTitle&&this.fieldInfoMap){const i=this._createFormattedAttributes(e,t,l).global;return a({attributes:n,expressionAttributes:null,fieldInfoMap:this.fieldInfoMap,globalAttributes:i,layer:e,text:this.workingTitle})}return""}catch(n){}return""}async _checkAndReQueryGraphic(e,t){const i=t.getObjectId();if(null==i)return t;if(!(0,u.Kl)(this.requiredFields,t)){const t=e.createQuery();t.where="1=1",t.outFields=[...this.requiredFields],t.objectIds=[i];const s=await e.queryFeatures(t);if(1===(null===s||void 0===s?void 0:s.features.length))return s.features[0]}return t}_createFieldInfoMap(e){const t=new Map;if(!e)return t;for(const s of e){var i;if(!s.fieldName)continue;const e=this.fieldsIndex.get(s.fieldName),r=null!==(i=null===e||void 0===e?void 0:e.name)&&void 0!==i?i:s.fieldName;s.fieldName=r,t.set(r.toLowerCase(),s)}return t}_createFormattedAttributes(e,t){var i,r,n;let l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"system";const a=null!==(i=null===(r=this.effectivePopupTemplate)||void 0===r?void 0:r.fieldInfos)&&void 0!==i?i:[],o={};if(!this._featureUtils)return{};if(!this.hasBadExpressions&&this.calculatedExpressions.length>0&&null!==(n=this._arcadeTask)&&void 0!==n&&n.value){const i=this._arcadeTask.value.Feature.createFromGraphicLikeObject(t.geometry,t.attributes,e,null);for(const e of this.calculatedExpressions)try{o["expression/".concat(e.name)]=e.func({vars:{$feature:i}})}catch(u){}}const d=(0,s.A)((0,s.A)({},t.attributes),o);return{global:this._featureUtils.formatAttributes({fieldInfos:a,attributes:d,graphic:t,timeZone:l,layer:e,fieldInfoMap:this.fieldInfoMap}),content:[]}}_extractFieldNames(e){return(0,u.nw)(e).filter((e=>!(0===e.indexOf("relationships/")||0===e.indexOf("expression/"))))}};(0,r._)([(0,o.MZ)({readOnly:!0})],f.prototype,"_arcadeTask",null),(0,r._)([(0,o.MZ)()],f.prototype,"_featureUtils",void 0),(0,r._)([(0,o.MZ)({readOnly:!0})],f.prototype,"featureUtilsPromise",null),(0,r._)([(0,o.MZ)({readOnly:!0})],f.prototype,"calculatedExpressions",null),(0,r._)([(0,o.MZ)()],f.prototype,"displayField",void 0),(0,r._)([(0,o.MZ)()],f.prototype,"effectivePopupTemplate",void 0),(0,r._)([(0,o.MZ)()],f.prototype,"expressionsUsedInTitle",null),(0,r._)([(0,o.MZ)()],f.prototype,"fieldsIndex",void 0),(0,r._)([(0,o.MZ)()],f.prototype,"fieldInfoMap",null),(0,r._)([(0,o.MZ)()],f.prototype,"fields",void 0),(0,r._)([(0,o.MZ)()],f.prototype,"objectIdField",void 0),(0,r._)([(0,o.MZ)()],f.prototype,"requiredFields",null),f=(0,r._)([(0,d.$)("esri.layers.support.TitleCreator")],f);const p=f},61701:(e,t,i)=>{var s;i.d(t,{X:()=>s}),function(e){e[e.SAVE=0]="SAVE",e[e.SAVE_AS=1]="SAVE_AS"}(s||(s={}))},64810:(e,t,i)=>{i.d(t,{Ch:()=>o,mW:()=>l,u2:()=>a});var s=i(89379),r=i(15941),n=i(34154);function l(e,t){return(0,s.A)((0,s.A)({},t),{},{filterMode:e.mode})}function a(e,t){var i;return null!==(i=d(e,t).next().value)&&void 0!==i?i:null}function o(e,t,i){const s=function(e){if("manual"===c(e))return null;const t=[Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY];for(const{minScale:i,maxScale:s}of e.filters)t[0]=Math.max(t[0],f(i)),t[1]=Math.min(t[1],p(s));return t}(e);if(s&&((0,r.gg)(t,s[0])||(0,r.ZH)(i,s[1])))return"";const l=Array.from(d(e,t,i)),a=function(e,t,i){var s,n;if(0===e.length)return!0;const l=f(null===(s=e.at(0))||void 0===s?void 0:s.minScale),a=p(null===(n=e.at(-1))||void 0===n?void 0:n.maxScale);if((0,r.ZH)(l,t)||(0,r.gg)(a,i))return!0;for(let o=0;o<e.length-1;o++){const t=e[o],i=e[o+1];if((0,r.ZH)(f(i.minScale),p(t.maxScale)))return!0}return!1}(l,t,i)?"1=1":l.map((e=>e.where||"1=1")).reduce(((e,t)=>(0,n.IW)(e,t)),"");return a&&"1=1"!==a?a:""}function*d(e,t,i){if("manual"===c(e)){const t=e.filters.find((t=>t.id===e.activeFilterId));t&&(yield t)}else{"object"==typeof t&&(t=t.scale);for(const s of e.filters)u(s.minScale,s.maxScale,t,i)&&(yield s)}}function u(e,t,i,s){return e=f(e),i=f(i),t=p(t),!(!(0,r.Sp)(i,e)&&(null!==s&&void 0!==s?s:i)>e)&&!(0,r.Hx)(t,i)&&(void 0===s||!(0,r.Sp)(s,e))}function c(e){return"mode"in e?e.mode:e.filterMode}function f(e){return e||Number.POSITIVE_INFINITY}function p(e){return e||0}}}]);
//# sourceMappingURL=3966.1f234bba.chunk.js.map