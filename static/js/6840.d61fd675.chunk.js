"use strict";(self.webpackChunkhousing_dashboard=self.webpackChunkhousing_dashboard||[]).push([[6840],{6840:(e,t,i)=>{i.r(t),i.d(t,{CIMSymbolRasterizer:()=>c});var h=i(30050),s=i(94110),n=i(401),r=i(48988),a=i(83367),o=i(97763);const l=96/72;class c{constructor(e){this._spatialReference=e,this._imageDataCanvas=null,this._cimResourceManager=new h.A}get _canvas(){return this._imageDataCanvas||(this._imageDataCanvas=document.createElement("canvas")),this._imageDataCanvas}get resourceManager(){return this._cimResourceManager}async rasterizeCIMSymbolAsync(e,t,i,h,s,l,c,d,u,y){if(!e)return null;const{data:m}=e;if(!m||"CIMSymbolReference"!==m.type||!m.symbol)return null;const{symbol:w}=m;l||(l=(0,o.n5)(w));const p=await r.OverrideHelper.resolveSymbolOverrides(m,t,this._spatialReference,s,l,c,d),x=this._cimResourceManager,M=[];n.wp.fetchResources(p,x,M),n.wp.fetchFonts(p,x,M),M.length>0&&await Promise.all(M);const{width:_,height:R}=i;let b=g(l,_,R,h,y);const f=n.wp.getEnvelope(p,b,x);if(!f)return null;f.x===1/0&&(f.x=_+2),f.y===1/0&&(f.y=-R/2),f.width===-1/0&&(f.width=_),f.height===-1/0&&(f.height=R);let v=1,C=0,I=0;switch(w.type){case"CIMPointSymbol":case"CIMTextSymbol":{let e=1;f.width>_&&(e=_/f.width);let t=1;f.height>R&&(t=R/f.height),"preview"===h&&(f.width<_&&(e=_/f.width),f.height<R&&(t=R/f.height)),v=Math.min(e,t),C=f.x+f.width/2,I=f.y+f.height/2}break;case"CIMLineSymbol":if(y){I=f.y+f.height/2,C=f.x+f.width/2;const e=f.width-_,t=f.height-R;b={paths:(0,a.hs)(b.paths,{xmin:-1*f.width/2+e,xmax:f.width/2-e,ymin:-1*f.height/2+t,ymax:f.height/2-t,width:f.width-2*e,height:f.height-2*t})}}else{(u||f.height>R)&&(v=R/f.height),I=f.y+f.height/2;const e=f.x*v+_/2,t=(f.x+f.width)*v+_/2,{paths:i}=b;i[0][0][0]-=e/v,i[0][2][0]-=(t-_)/v}break;case"CIMPolygonSymbol":if(y){I=f.y+f.height/2,C=f.x+f.width/2;const e=f.width-_,t=f.height-R;b={paths:(0,a.hs)(b.rings,{xmin:-1*f.width/2+e,xmax:f.width/2-e,ymin:-1*f.height/2+t,ymax:f.height/2-t,width:f.width-2*e,height:f.height-2*t})}}else{C=f.x+f.width/2,I=f.y+f.height/2;const e=f.x*v+_/2,t=(f.x+f.width)*v+_/2,i=f.y*v+R/2,h=(f.y+f.height)*v+R/2,{rings:s}=b;e<0&&(s[0][0][0]-=e,s[0][3][0]-=e,s[0][4][0]-=e),i<0&&(s[0][0][1]+=i,s[0][1][1]+=i,s[0][4][1]+=i),t>_&&(s[0][1][0]-=t-_,s[0][2][0]-=t-_),h>R&&(s[0][2][1]+=h-R,s[0][3][1]+=h-R)}}const P={type:"cim",data:{type:"CIMSymbolReference",symbol:p}};return this.rasterize(P,_,R,C,I,v,l,1,b)}rasterize(e,t,i,h,n,r,a){let c=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,d=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,u=arguments.length>9&&void 0!==arguments[9]?arguments[9]:window.devicePixelRatio||1;const{data:y}=e;if(!y||"CIMSymbolReference"!==y.type||!y.symbol)return null;const{symbol:m}=y,w=this._canvas,p=u*l;w.width=t*p,w.height=i*p,a||(a=(0,o.n5)(m)),d||(d=g(a,t,i,"legend")),w.width+=2*c,w.height+=2*c;const x=w.getContext("2d",{willReadFrequently:!0}),M=s.IT.createIdentity();return M.translate(-h,-n),M.scale(r*p,-r*p),M.translate(t*p/2+c,i*p/2+c),x.clearRect(0,0,w.width,w.height),new s.Rj(x,this._cimResourceManager,M,!0).drawSymbol(m,d),x.getImageData(0,0,w.width,w.height)}}function g(e,t,i,h,s){const n=-t/2+1,r=t/2-1,o=i/2-1,l=-i/2+1;if(s&&("esriGeometryPolygon"===e||"esriGeometryPolyline"===e)){const h=function(e,t,i,h){return"esriGeometryPolygon"===t?{rings:(0,a.Tl)((0,a.hs)(e.rings,{xmin:0,ymin:0,xmax:i,ymax:h,width:i,height:h}),-1*i/2,-1*h/2)}:"esriGeometryPolyline"===t?{paths:(0,a.Tl)((0,a.hs)(e.paths,{xmin:0,ymin:0,xmax:i,ymax:h,width:i,height:h}),-1*i/2,-1*h/2)}:null}(s,e,t,i);if(h)return h}switch(e){case"esriGeometryPoint":return{x:0,y:0};case"esriGeometryPolyline":return{paths:[[[n,0],[0,0],[r,0]]]};default:return"legend"===h?{rings:[[[n,o],[r,0],[r,l],[n,l],[n,o]]]}:{rings:[[[n,o],[r,o],[r,l],[n,l],[n,o]]]}}}},30050:(e,t,i)=>{i.d(t,{A:()=>n});var h=i(85504),s=i(16770);class n{constructor(){this._resourceMap=new Map,this._inFlightResourceMap=new Map,this.geometryEngine=null,this.geometryEnginePromise=null}destroy(){this._inFlightResourceMap.clear(),this._resourceMap.clear()}getResource(e){var t;return null!==(t=this._resourceMap.get(e))&&void 0!==t?t:null}async fetchResource(e,t){const i=this._resourceMap.get(e);if(i)return{width:i.width,height:i.height};let h=this._inFlightResourceMap.get(e);return h?h.then((e=>({width:e.width,height:e.height}))):(h=(0,s.M5)(e,t),this._inFlightResourceMap.set(e,h),h.then((t=>(this._inFlightResourceMap.delete(e),this._resourceMap.set(e,t),{width:t.width,height:t.height})),(()=>({width:0,height:0}))))}deleteResource(e){this._inFlightResourceMap.delete(e),this._resourceMap.delete(e)}loadFont(e){return(0,h.Al)(e)}}}}]);
//# sourceMappingURL=6840.d61fd675.chunk.js.map